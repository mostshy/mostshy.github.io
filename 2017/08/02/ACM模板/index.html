<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="收集的一些ACM相关的模板," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="ACM模板AC自动机 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899">
<meta name="keywords" content="收集的一些ACM相关的模板">
<meta property="og:type" content="article">
<meta property="og:title" content="ACM模板">
<meta property="og:url" content="http://yoursite.com/2017/08/02/ACM模板/index.html">
<meta property="og:site_name" content="mostshy&#39;Blog">
<meta property="og:description" content="ACM模板AC自动机 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-01T19:31:02.718Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ACM模板">
<meta name="twitter:description" content="ACM模板AC自动机 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/08/02/ACM模板/"/>





  <title>ACM模板 | mostshy'Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mostshy'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I good vegetable a.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/02/ACM模板/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mostshy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mostshy'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ACM模板</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-02T02:11:09+08:00">
                2017-08-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="ACM模板"><a href="#ACM模板" class="headerlink" title="ACM模板"></a>ACM模板</h1><h3 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxnode=<span class="number">11000</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> sigma_size=<span class="number">26</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC_Automata</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> ch[maxnode][sigma_size];</div><div class="line">    <span class="keyword">int</span> val[maxnode];   <span class="comment">// 每个字符串的结尾结点都有一个非0的val</span></div><div class="line">    <span class="keyword">int</span> f[maxnode];     <span class="comment">// fail函数</span></div><div class="line">    <span class="keyword">int</span> last[maxnode];  <span class="comment">// last[i]=j表j节点表示的单词是i节点单词的后缀，且j节点是单词节点</span></div><div class="line">    <span class="keyword">int</span> sz;</div><div class="line"></div><div class="line">    <span class="comment">//初始化0号根节点的相关信息</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        sz=<span class="number">1</span>;</div><div class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>],<span class="number">0</span>,<span class="keyword">sizeof</span>(ch[<span class="number">0</span>]));</div><div class="line">        val[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//insert负责构造ch与val数组</span></div><div class="line">    <span class="comment">//插入字符串,v必须非0表示一个单词节点</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">int</span> v)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s),u=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> id=s[i]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">if</span>(ch[u][id]==<span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                ch[u][id]=sz;</div><div class="line">                <span class="built_in">memset</span>(ch[sz],<span class="number">0</span>,<span class="keyword">sizeof</span>(ch[sz]));</div><div class="line">                val[sz++]=<span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            u=ch[u][id];</div><div class="line">        &#125;</div><div class="line">        val[u]=v;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//getFail函数负责构造f和last数组</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</div><div class="line">        last[<span class="number">0</span>]=f[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;sigma_size; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> u=ch[<span class="number">0</span>][i];</div><div class="line">            <span class="keyword">if</span>(u)</div><div class="line">            &#123;</div><div class="line">                f[u]=last[u]=<span class="number">0</span>;</div><div class="line">                q.push(u);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">while</span>(!q.empty())<span class="comment">// 按BFS顺序计算fail</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> r=q.front(); q.pop();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;sigma_size; i++)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">int</span> u=ch[r][i];</div><div class="line">                <span class="keyword">if</span>(u==<span class="number">0</span>)<span class="keyword">continue</span>;</div><div class="line">                q.push(u);</div><div class="line"></div><div class="line">                <span class="keyword">int</span> v=f[r];</div><div class="line">                <span class="keyword">while</span>(v &amp;&amp; ch[v][i]==<span class="number">0</span>) v=f[v];</div><div class="line">                f[u]= ch[v][i];</div><div class="line">                last[u] =  val[f[u]]?f[u]:last[f[u]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//递归打印与结点i后缀相同的前缀节点编号</span></div><div class="line">    <span class="comment">//进入此函数前需保证val[i]&gt;0</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> i)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(i)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i);</div><div class="line">            print(last[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 在s中找出 出现了哪几个模板单词</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">(<span class="keyword">char</span> *s)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s),j=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> id=s[i]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">while</span>(j &amp;&amp; ch[j][id]==<span class="number">0</span>) j=f[j];</div><div class="line">            j=ch[j][id];</div><div class="line">            <span class="keyword">if</span>(val[j]) print(j);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(last[j]) print(last[j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;;</div><div class="line">AC_Automata ac;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="CDQ分治"><a href="#CDQ分治" class="headerlink" title="CDQ分治"></a>CDQ分治</h2> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">平面上有N个点，每个点的横纵坐标在[0,1e7]之间，有M个询问，每个询问为查询在指定矩形之内有多少个点，</div><div class="line">矩形用(x1,y1,x2,y2)的方式给出，其中(x1,y1)为左下角坐标，(x2,y2)为右上角坐标。</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">500001</span>; <span class="comment">// 点的数量</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">500001</span>; <span class="comment">// 询问数量</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = MAXN+(MAXM&lt;&lt;<span class="number">2</span>);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">10000002</span>; <span class="comment">// 树状数组大小</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> n, m, maxy = <span class="number">-1</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> IO &#123; <span class="comment">// 快读相关</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> BUFSZ = <span class="number">1e7</span>;</div><div class="line">    <span class="keyword">char</span> buf[BUFSZ]; <span class="keyword">int</span> idx, end;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; idx = BUFSZ; &#125;</div><div class="line">    <span class="function"><span class="keyword">char</span> <span class="title">getch</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>( idx == BUFSZ ) &#123;</div><div class="line">            end = fread( buf, <span class="number">1</span>, BUFSZ, <span class="built_in">stdin</span> ); idx = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>( idx == end ) <span class="keyword">return</span> EOF;</div><div class="line">        <span class="keyword">return</span> buf[idx++];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getint</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> num = <span class="number">0</span>; <span class="keyword">char</span> ch;</div><div class="line">        <span class="keyword">while</span>( <span class="built_in">isspace</span>(ch=getch()) );</div><div class="line">        <span class="keyword">do</span> &#123; num = num*<span class="number">10</span> + ch-<span class="string">'0'</span>; &#125; <span class="keyword">while</span>( <span class="built_in">isdigit</span>(ch=getch()) );</div><div class="line">        <span class="keyword">return</span> num;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">using</span> IO::getint;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> type, x, y, w, aid; <span class="comment">// w表示对查询结果贡献(+还是-)，aid是“第几个查询”</span></div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;( <span class="keyword">const</span> Query &amp;rhs ) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> x == rhs.x ? type &lt; rhs.type : x &lt; rhs.x;</div><div class="line">    &#125;</div><div class="line">&#125;query[MAXQ];</div><div class="line"><span class="keyword">int</span> qidx = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addq</span><span class="params">( <span class="keyword">int</span> type, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> aid )</span> </span>&#123;</div><div class="line">    query[qidx++] = (Query)&#123;type,x,y,w,aid&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> ans[MAXM], aidx = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> BIT &#123; <span class="comment">// 树状数组相关</span></div><div class="line">    <span class="keyword">int</span> arr[MAXL];</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">( <span class="keyword">int</span> num )</span> </span>&#123; <span class="keyword">return</span> num&amp;(-num); &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( <span class="keyword">int</span> idx, <span class="keyword">int</span> val )</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>( idx &lt;= maxy ) &#123;</div><div class="line">            arr[idx] += val;</div><div class="line">            idx += lowbit(idx);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">( <span class="keyword">int</span> idx )</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>( idx ) &#123;</div><div class="line">            ans += arr[idx];</div><div class="line">            idx -= lowbit(idx);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ans;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">( <span class="keyword">int</span> idx )</span></span>&#123;</div><div class="line">        <span class="keyword">while</span>( idx &lt;= maxy ) &#123;</div><div class="line">            <span class="keyword">if</span>( arr[idx] ) arr[idx] = <span class="number">0</span>; <span class="keyword">else</span> <span class="keyword">break</span>;</div><div class="line">            idx += lowbit(idx);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Query tmp[MAXQ];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">( <span class="keyword">int</span> L, <span class="keyword">int</span> R )</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>( R-L &lt;= <span class="number">1</span> ) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> M = (L+R)&gt;&gt;<span class="number">1</span>; cdq(L,M); cdq(M,R);</div><div class="line">    <span class="keyword">int</span> p = L, q = M, o = L;</div><div class="line">    <span class="keyword">while</span>( p &lt; M &amp;&amp; q &lt; R ) &#123;</div><div class="line">        <span class="keyword">if</span>( query[p] &lt; query[q] ) &#123;</div><div class="line">            <span class="keyword">if</span>( query[p].type == <span class="number">0</span> ) BIT::add( query[p].y, <span class="number">1</span> );</div><div class="line">            tmp[o++] = query[p++];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>( query[q].type == <span class="number">1</span> ) ans[query[q].aid] += query[q].w * BIT::query( query[q].y );</div><div class="line">            tmp[o++] = query[q++];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>( p &lt; M ) tmp[o++] = query[p++];</div><div class="line">    <span class="keyword">while</span>( q &lt; R ) &#123;</div><div class="line">        <span class="keyword">if</span>( query[q].type == <span class="number">1</span> ) ans[query[q].aid] += query[q].w * BIT::query( query[q].y );</div><div class="line">        tmp[o++] = query[q++];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = L; i &lt; R; ++i ) &#123;</div><div class="line">        BIT::clear( tmp[i].y ); <span class="comment">// 清空树状数组</span></div><div class="line">        query[i] = tmp[i];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    IO::init(); n = getint(); m = getint();</div><div class="line">    <span class="keyword">while</span>( n-- ) &#123;</div><div class="line">        <span class="keyword">int</span> x,y; x = getint(); y = getint(); ++x; ++y; <span class="comment">// 为了方便，把坐标转化为[1,1e7+1]</span></div><div class="line">        addq(<span class="number">0</span>,x,y,<span class="number">0</span>,<span class="number">0</span>); maxy = max( maxy, y ); <span class="comment">// 修改操作无附加信息</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>( m-- ) &#123;</div><div class="line">        <span class="keyword">int</span> x1,y1,x2,y2; x1 = getint(); y1 = getint(); x2 = getint(); y2 = getint(); ++x1; ++y1; ++x2; ++y2;</div><div class="line">        addq(<span class="number">1</span>,x1<span class="number">-1</span>,y1<span class="number">-1</span>,<span class="number">1</span>,aidx); addq(<span class="number">1</span>,x1<span class="number">-1</span>,y2,<span class="number">-1</span>,aidx); addq(<span class="number">1</span>,x2,y1<span class="number">-1</span>,<span class="number">-1</span>,aidx); addq(<span class="number">1</span>,x2,y2,<span class="number">1</span>,aidx); ++aidx;</div><div class="line">        maxy = max( maxy, max(y1,y2) );</div><div class="line">    &#125;</div><div class="line">    cdq(<span class="number">0</span>,qidx);</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; aidx; ++i ) <span class="built_in">printf</span>( <span class="string">"%d\n"</span>, ans[i] );</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">CDQ分治+斜率dp</div><div class="line"><span class="comment">/*</span></div><div class="line">dp[i]=min&#123;dp[j]+(S+T[i]-T[j])*F[i]&#125;;</div><div class="line">dp[j]=F[i]*T[j]+dp[i]-(S+T[i])*F[i];</div><div class="line">令y=dp[j],x=T[j],k=F[i];</div><div class="line">则要让dp[i]最小，则斜率为k的直线切y轴最小</div><div class="line">维护下凸包</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 300010</span></div><div class="line"><span class="keyword">int</span> t[maxn],f[maxn],st[maxn],S;</div><div class="line">ll T[maxn],F[maxn],ans[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">query</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> p,x;</div><div class="line">    ll y,k;</div><div class="line">    query() &#123;</div><div class="line">        y=<span class="number">1e18</span>;</div><div class="line">    &#125;</div><div class="line">    query(<span class="keyword">int</span> p,<span class="keyword">int</span> x,ll y,ll k):p(p),x(x),y(y),k(k) &#123;&#125;</div><div class="line">&#125; q[maxn],q1[maxn],q2[maxn];</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">getk</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(q[i].x==q[j].x&amp;&amp;q[i].y&lt;q[j].y) <span class="keyword">return</span> <span class="number">-1e18</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(q[i].x==q[j].x) <span class="keyword">return</span> <span class="number">1e18</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">1.0</span>*(q[i].y-q[j].y)/(q[i].x-q[j].x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(L&gt;R) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(L==R) &#123;</div><div class="line">        ans[q[L].p]=q[L].y;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> M=(L+R)/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=R; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(q[i].p&lt;=M) q1[a++]=q[i];</div><div class="line">        <span class="keyword">else</span> q2[b++]=q[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;L+a; i++) q[i]=q1[i-L];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L+a; i&lt;=R; i++) q[i]=q2[i-L-a];</div><div class="line">    cdq(L,M);</div><div class="line">    <span class="keyword">int</span> top=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=M; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(top&gt;<span class="number">1</span>&amp;&amp;getk(i,st[top<span class="number">-1</span>])&lt;=getk(st[top<span class="number">-1</span>],st[top<span class="number">-2</span>])) top--;</div><div class="line">        st[top++]=i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=M+<span class="number">1</span>; i&lt;=R; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(j&lt;top<span class="number">-1</span>&amp;&amp;(<span class="keyword">double</span>)q[i].k&gt;getk(st[j+<span class="number">1</span>],st[j])) j++;</div><div class="line">        <span class="keyword">int</span> k=st[j];</div><div class="line">        q[i].y=min(q[i].y,q[k].y+(S+T[q[i].p]-T[q[k].p])*F[q[i].p]);</div><div class="line"><span class="comment">//        printf("%d %d %d %lld\n",L,R,j,q[i].y);</span></div><div class="line">    &#125;</div><div class="line">    cdq(M+<span class="number">1</span>,R);</div><div class="line">    a=L;</div><div class="line">    b=M+<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> o=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(a&lt;=M&amp;&amp;b&lt;=R) &#123;</div><div class="line">        <span class="keyword">if</span>(q[a].x&lt;q[b].x) q1[o++]=q[a++];</div><div class="line">        <span class="keyword">else</span> q1[o++]=q[b++];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(a&lt;=M) q1[o++]=q[a++];</div><div class="line">    <span class="keyword">while</span>(b&lt;=R) q1[o++]=q[b++];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=R; i++) &#123;</div><div class="line">        q[i]=q1[i-L];</div><div class="line"><span class="comment">//        printf("**%d\n",q[i].x);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> query &amp;a,<span class="keyword">const</span> query &amp;b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.k&lt;b.k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//    freopen("data.txt","r",stdin);</span></div><div class="line"><span class="comment">//    freopen("ans.txt","w",stdout);</span></div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;S);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;t[i],&amp;f[i]);</div><div class="line">    q[<span class="number">0</span>]=query(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n+<span class="number">10</span>; i++) q[i].y=<span class="number">1e18</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        T[i]=T[i<span class="number">-1</span>]+t[n-i+<span class="number">1</span>];</div><div class="line">        F[i]=F[i<span class="number">-1</span>]+(ll)f[n-i+<span class="number">1</span>];</div><div class="line">        q[i].p=i;</div><div class="line">        q[i].x=T[i];</div><div class="line">        q[i].k=F[i];</div><div class="line">    &#125;</div><div class="line"><span class="comment">//    sort(q,q+n+1,cmp);</span></div><div class="line">    cdq(<span class="number">0</span>,n);</div><div class="line"><span class="comment">//    for(int i=0;i&lt;=n;i++)</span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans[n]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">5 1</div><div class="line">0 2</div><div class="line">2 2</div><div class="line">1 2</div><div class="line">0 2</div><div class="line">-2 2</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//LCA RMQ</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100010</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> to,cost;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;node&gt; g[maxn];</div><div class="line"><span class="keyword">int</span> ver[<span class="number">2</span>*maxn],id[<span class="number">2</span>*maxn],first[maxn];</div><div class="line"><span class="keyword">int</span> dis[maxn];;</div><div class="line"><span class="comment">//  ver[i] : i 对应的节点编号</span></div><div class="line"><span class="comment">//  id[i] :  i 对应节点深度</span></div><div class="line"><span class="keyword">int</span> tot,n,q;</div><div class="line"><span class="keyword">int</span> dp[<span class="number">2</span>*maxn][<span class="number">30</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> dep,<span class="keyword">int</span> s,<span class="keyword">int</span> fa)</span></span>&#123;</div><div class="line">    ver[++tot]=root;id[tot]=dep;first[root]=tot;dis[root]=s;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;g[root].size();i++)&#123;</div><div class="line">        <span class="keyword">int</span> v=g[root][i].to,w=g[root][i].cost;</div><div class="line">        <span class="keyword">if</span>(v==fa) <span class="keyword">continue</span>;</div><div class="line">        dfs(v,dep+<span class="number">1</span>,s+w,root);</div><div class="line">        ver[++tot]=root;id[tot]=dep;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ST</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tot;i++)</div><div class="line">        dp[i][<span class="number">0</span>]=i;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j)&lt;=tot;j++)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=tot;i++)&#123;</div><div class="line">            <span class="keyword">int</span> a=dp[i][j<span class="number">-1</span>],b=dp[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>];</div><div class="line">            dp[i][j]=id[a]&lt;id[b]?a:b;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">RMQ</span><span class="params">(<span class="keyword">int</span> le,<span class="keyword">int</span> ri)</span></span>&#123;</div><div class="line">    le=first[le],ri=first[ri];</div><div class="line">    <span class="keyword">if</span>(le&gt;ri) swap(le,ri);</div><div class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;(k+<span class="number">1</span>))&lt;=ri-le+<span class="number">1</span>) k++;</div><div class="line">    <span class="keyword">int</span> a=dp[le][k],b=dp[ri-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k];</div><div class="line">    <span class="keyword">return</span> id[a]&lt;id[b]?ver[a]:ver[b];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> ca,kase=<span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;ca);</div><div class="line">    <span class="keyword">while</span>(ca--)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;maxn;i++) g[i].clear();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</div><div class="line">        <span class="keyword">int</span> u,v,w;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;u,&amp;v,&amp;w);</div><div class="line">            g[u].push_back((node)&#123;v,w&#125;);</div><div class="line">            g[v].push_back((node)&#123;u,w&#125;);</div><div class="line">        &#125;</div><div class="line">        tot=<span class="number">0</span>;dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>);</div><div class="line">        ST();</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="LCA倍增法"><a href="#LCA倍增法" class="headerlink" title="LCA倍增法"></a>LCA倍增法</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//LCA倍增法</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="number">1.</span> DFS预处理出所有节点的深度和父节点</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span>(i=head[u]; i!=<span class="number">-1</span>; i=next[i]) &#123;</div><div class="line">        <span class="keyword">if</span> (!deep[to[i]]) &#123;</div><div class="line">            deep[to[i]] = deep[u]+<span class="number">1</span>;</div><div class="line">            p[to[i]][<span class="number">0</span>] = u; <span class="comment">//p[x][0]保存x的父节点为u;</span></div><div class="line">            dfs(to[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="number">2.</span> 初始各个点的<span class="number">2</span>^j祖先是谁 ,其中 <span class="number">2</span>^j (j =<span class="number">0.</span>..<span class="built_in">log</span>(该点深度))倍祖先，<span class="number">1</span>倍祖先就是父亲，<span class="number">2</span>倍祖先是父亲的父亲......。</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="comment">//p[i][j]表示i结点的第2^j祖先</span></div><div class="line">    <span class="keyword">for</span>(j=<span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j)&lt;=n; j++)</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>; i&lt;=n; i++)</div><div class="line">            <span class="keyword">if</span>(p[i][j<span class="number">-1</span>]!=<span class="number">-1</span>)</div><div class="line">                p[i][j]=p[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];<span class="comment">//i的第2^j祖先就是i的第2^(j-1)祖先的第2^(j-1)祖先</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="number">3.</span>从深度大的节点上升至深度小的节点同层，如果此时两节点相同直接返回此节点，即lca。</div><div class="line"></div><div class="line">否则，利用倍增法找到最小深度的 p[a][j]!=p[b][j]，此时他们的父亲p[a][<span class="number">0</span>]即lca。</div><div class="line"></div><div class="line"><span class="keyword">int</span> lca(<span class="keyword">int</span> a,<span class="keyword">int</span> b) &#123; <span class="comment">//最近公共祖先</span></div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">if</span>(deep[a]&lt;deep[b])swap(a,b);</div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; (<span class="number">1</span>&lt;&lt;i)&lt;=deep[a]; i++);</div><div class="line">    i--;</div><div class="line">    <span class="comment">//使a，b两点的深度相同</span></div><div class="line">    <span class="keyword">for</span>(j=i; j&gt;=<span class="number">0</span>; j--)</div><div class="line">        <span class="keyword">if</span>(deep[a]-(<span class="number">1</span>&lt;&lt;j)&gt;=deep[b])</div><div class="line">            a=p[a][j];</div><div class="line">    <span class="keyword">if</span>(a==b)<span class="keyword">return</span> a;</div><div class="line">    <span class="comment">//倍增法，每次向上进深度2^j，找到最近公共祖先的子结点</span></div><div class="line">    <span class="keyword">for</span>(j=i; j&gt;=<span class="number">0</span>; j--) &#123;</div><div class="line">        <span class="keyword">if</span>(p[a][j]!=<span class="number">-1</span>&amp;&amp;p[a][j]!=p[b][j]) &#123;</div><div class="line">            a=p[a][j];</div><div class="line">            b=p[b][j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> p[a][<span class="number">0</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="刘汝佳计算几何模板"><a href="#刘汝佳计算几何模板" class="headerlink" title="刘汝佳计算几何模板"></a>刘汝佳计算几何模板</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// Geometry.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lson l, m, rt&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rson m+1, r, rt&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926535897932384626</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EXIT exit(0);</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG puts(<span class="meta-string">"Here is a BUG"</span>);</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CLEAR(name, init) memset(name, init, sizeof(name))</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-6</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = (<span class="keyword">int</span>)<span class="number">1e9</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Vector Point</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ChongHe 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NeiHan 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NeiQie 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INTERSECTING 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WaiQie 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> XiangLi 5</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dcmp</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">fabs</span>(x) &lt; eps ? <span class="number">0</span> : (x &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>); &#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line"></div><div class="line">    Point(<span class="keyword">const</span> Point&amp; rhs): x(rhs.x), y(rhs.y) &#123; &#125; <span class="comment">//拷贝构造函数</span></div><div class="line">    Point(<span class="keyword">double</span> x = <span class="number">0.0</span>, <span class="keyword">double</span> y = <span class="number">0.0</span>): x(x), y(y) &#123; &#125;   <span class="comment">//构造函数</span></div><div class="line"></div><div class="line">    <span class="keyword">friend</span> istream&amp; <span class="keyword">operator</span> &gt;&gt; (istream&amp; in, Point&amp; P) &#123; <span class="keyword">return</span> in &gt;&gt; P.x &gt;&gt; P.y; &#125;</div><div class="line">    <span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span> &lt;&lt; (ostream&amp; out, <span class="keyword">const</span> Point&amp; P) &#123; <span class="keyword">return</span> out &lt;&lt; P.x &lt;&lt; <span class="string">' '</span> &lt;&lt; P.y; &#125;</div><div class="line"></div><div class="line">    <span class="keyword">friend</span> Vector <span class="keyword">operator</span> + (<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B) &#123; <span class="keyword">return</span> Vector(A.x+B.x, A.y+B.y); &#125;</div><div class="line">    <span class="keyword">friend</span> Vector <span class="keyword">operator</span> - (<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B) &#123; <span class="keyword">return</span> Vector(A.x-B.x, A.y-B.y); &#125;</div><div class="line">    <span class="keyword">friend</span> Vector <span class="keyword">operator</span> * (<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> <span class="keyword">double</span>&amp; p) &#123; <span class="keyword">return</span> Vector(A.x*p, A.y*p); &#125;</div><div class="line">    <span class="keyword">friend</span> Vector <span class="keyword">operator</span> / (<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> <span class="keyword">double</span>&amp; p) &#123; <span class="keyword">return</span> Vector(A.x/p, A.y/p); &#125;</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B) &#123; <span class="keyword">return</span> dcmp(A.x-B.x) == <span class="number">0</span> &amp;&amp; dcmp(A.y-B.y) == <span class="number">0</span>; &#125;</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B) &#123; <span class="keyword">return</span> A.x &lt; B.x || (A.x == B.x &amp;&amp; A.y &lt; B.y); &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">in</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; <span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>, &amp;x, &amp;y); &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">out</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; <span class="built_in">printf</span>(<span class="string">"%lf %lf"</span>, x, y); &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span> &#123;</span></div><div class="line">    Point P;    <span class="comment">//直线上一点</span></div><div class="line">    Vector dir; <span class="comment">//方向向量(半平面交中该向量左侧表示相应的半平面)</span></div><div class="line">    <span class="keyword">double</span> ang; <span class="comment">//极角，即从x正半轴旋转到向量dir所需要的角（弧度）</span></div><div class="line"></div><div class="line">    Line() &#123; &#125;  <span class="comment">//构造函数</span></div><div class="line">    Line(<span class="keyword">const</span> Line&amp; L): P(L.P), dir(L.dir), ang(L.ang) &#123; &#125;</div><div class="line">    Line(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Vector&amp; dir): P(P), dir(dir) &#123; ang = <span class="built_in">atan2</span>(dir.y, dir.x); &#125;</div><div class="line"></div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Line&amp; L) <span class="keyword">const</span> &#123; <span class="comment">//极角排序</span></div><div class="line">        <span class="keyword">return</span> ang &lt; L.ang;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function">Point <span class="title">point</span><span class="params">(<span class="keyword">double</span> t)</span> </span>&#123; <span class="keyword">return</span> P + dir*t; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;Point&gt; Polygon;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> &#123;</span></div><div class="line">    Point c;    <span class="comment">//圆心</span></div><div class="line">    <span class="keyword">double</span> r;   <span class="comment">//半径</span></div><div class="line"></div><div class="line">    Circle() &#123; &#125;</div><div class="line">    Circle(<span class="keyword">const</span> Circle&amp; rhs): c(rhs.c), r(rhs.r) &#123; &#125;</div><div class="line">    Circle(<span class="keyword">const</span> Point&amp; c, <span class="keyword">const</span> <span class="keyword">double</span>&amp; r): c(c), r(r) &#123; &#125;</div><div class="line"></div><div class="line">    <span class="function">Point <span class="title">point</span><span class="params">(<span class="keyword">double</span> ang)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> Point(c.x + <span class="built_in">cos</span>(ang)*r, c.y + <span class="built_in">sin</span>(ang)*r); &#125; <span class="comment">//圆心角所对应的点</span></div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">area</span><span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> PI * r * r; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Dot</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x*B.x + A.y*B.y; &#125;  <span class="comment">//点积</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Length</span><span class="params">(<span class="keyword">const</span> Vector&amp; A)</span></span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(Dot(A, A)); &#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Angle</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">acos</span>(Dot(A, B)/Length(A)/Length(B)); &#125;  <span class="comment">//向量夹角</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Cross</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x*B.y - A.y*B.x; &#125;    <span class="comment">//叉积</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Area</span><span class="params">(<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B, <span class="keyword">const</span> Point&amp; C)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">fabs</span>(Cross(B-A, C-A)); &#125;</div><div class="line"></div><div class="line"><span class="comment">//三边构成三角形的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_length</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dcmp(a+b-c) &gt; <span class="number">0</span> &amp;&amp; dcmp(<span class="built_in">fabs</span>(a-b)-c) &lt; <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isTriangle</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> check_length(a, b, c) &amp;&amp; check_length(a, c, b) &amp;&amp; check_length(b, c, a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//平行四边形的判定（保证四边形顶点按顺序给出）</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isParallelogram</span><span class="params">(Polygon p)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (dcmp(Length(p[<span class="number">0</span>]-p[<span class="number">1</span>]) - Length(p[<span class="number">2</span>]-p[<span class="number">3</span>])) || dcmp(Length(p[<span class="number">0</span>]-p[<span class="number">3</span>]) - Length(p[<span class="number">2</span>]-p[<span class="number">1</span>]))) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    Line a = Line(p[<span class="number">0</span>], p[<span class="number">1</span>]-p[<span class="number">0</span>]);</div><div class="line">    Line b = Line(p[<span class="number">1</span>], p[<span class="number">2</span>]-p[<span class="number">1</span>]);</div><div class="line">    Line c = Line(p[<span class="number">3</span>], p[<span class="number">2</span>]-p[<span class="number">3</span>]);</div><div class="line">    Line d = Line(p[<span class="number">0</span>], p[<span class="number">3</span>]-p[<span class="number">0</span>]);</div><div class="line">    <span class="keyword">return</span> dcmp(a.ang - c.ang) == <span class="number">0</span> &amp;&amp; dcmp(b.ang - d.ang) == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//梯形的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isTrapezium</span><span class="params">(Polygon p)</span> </span>&#123;</div><div class="line">    Line a = Line(p[<span class="number">0</span>], p[<span class="number">1</span>]-p[<span class="number">0</span>]);</div><div class="line">    Line b = Line(p[<span class="number">1</span>], p[<span class="number">2</span>]-p[<span class="number">1</span>]);</div><div class="line">    Line c = Line(p[<span class="number">3</span>], p[<span class="number">2</span>]-p[<span class="number">3</span>]);</div><div class="line">    Line d = Line(p[<span class="number">0</span>], p[<span class="number">3</span>]-p[<span class="number">0</span>]);</div><div class="line">    <span class="keyword">return</span> (dcmp(a.ang - c.ang) == <span class="number">0</span> &amp;&amp; dcmp(b.ang - d.ang)) || (dcmp(a.ang - c.ang) &amp;&amp; dcmp(b.ang - d.ang) == <span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//菱形的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRhombus</span><span class="params">(Polygon p)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!isParallelogram(p)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">return</span> dcmp(Length(p[<span class="number">1</span>]-p[<span class="number">0</span>]) - Length(p[<span class="number">2</span>]-p[<span class="number">1</span>])) == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//矩形的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRectangle</span><span class="params">(Polygon p)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!isParallelogram(p)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">return</span> dcmp(Length(p[<span class="number">2</span>]-p[<span class="number">0</span>]) - Length(p[<span class="number">3</span>]-p[<span class="number">1</span>])) == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//正方形的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSquare</span><span class="params">(Polygon p)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> isRectangle(p) &amp;&amp; isRhombus(p);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//三点共线的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isCollinear</span><span class="params">(Point A, Point B, Point C)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dcmp(Cross(B-A, C-B)) == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//向量绕起点旋转</span></div><div class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> <span class="keyword">double</span>&amp; rad)</span> </span>&#123; <span class="keyword">return</span> Vector(A.x*<span class="built_in">cos</span>(rad)-A.y*<span class="built_in">sin</span>(rad), A.x*<span class="built_in">sin</span>(rad)+A.y*<span class="built_in">cos</span>(rad)); &#125;</div><div class="line"></div><div class="line"><span class="comment">//向量的单位法线(调用前请确保A 不是零向量)</span></div><div class="line"><span class="function">Vector <span class="title">Normal</span><span class="params">(<span class="keyword">const</span> Vector&amp; A)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> len = Length(A);</div><div class="line">    <span class="keyword">return</span> Vector(-A.y / len, A.x / len);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//两直线交点(用前确保两直线有唯一交点，当且仅当Cross(A.dir, B.dir)非0)</span></div><div class="line"><span class="function">Point <span class="title">GetLineIntersection</span><span class="params">(<span class="keyword">const</span> Line&amp; A, <span class="keyword">const</span> Line&amp; B)</span> </span>&#123;</div><div class="line">    Vector u = A.P - B.P;</div><div class="line">    <span class="keyword">double</span> t = Cross(B.dir, u) / Cross(A.dir, B.dir);</div><div class="line">    <span class="keyword">return</span> A.P + A.dir*t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点到直线距离</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">DistanceToLine</span><span class="params">(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Line&amp; L)</span> </span>&#123;</div><div class="line">    Vector v1 = L.dir, v2 = P - L.P;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(Cross(v1, v2)) / Length(v1);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点到线段距离</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">DistanceToSegment</span><span class="params">(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (A == B) <span class="keyword">return</span> Length(P - A);</div><div class="line">    Vector v1 = B - A, v2 = P - A, v3 = P - B;</div><div class="line">    <span class="keyword">if</span> (dcmp(Dot(v1, v2)) &lt; <span class="number">0</span>) <span class="keyword">return</span> Length(v2);</div><div class="line">    <span class="keyword">if</span> (dcmp(Dot(v1, v3)) &gt; <span class="number">0</span>) <span class="keyword">return</span> Length(v3);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(Cross(v1, v2)) / Length(v1);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点在直线上的投影</span></div><div class="line"><span class="function">Point <span class="title">GetLineProjection</span><span class="params">(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Line&amp; L)</span> </span>&#123; <span class="keyword">return</span> L.P + L.dir*(Dot(L.dir, P - L.P)/Dot(L.dir, L.dir)); &#125;</div><div class="line"></div><div class="line"><span class="comment">//点在线段上的判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isOnSegment</span><span class="params">(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B)</span> </span>&#123;</div><div class="line">    <span class="comment">//若允许点与端点重合，可关闭下面的注释</span></div><div class="line">    <span class="comment">//if (P == A || P == B) return true;</span></div><div class="line">    <span class="comment">// return dcmp(Cross(A-P, B-P)) == 0 &amp;&amp; dcmp(Dot(A-P, B-P)) &lt; 0;</span></div><div class="line">    <span class="keyword">return</span> dcmp(Length(P-A) + Length(B-P) - Length(A-B)) == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//线段相交判定</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SegmentProperIntersection</span><span class="params">(<span class="keyword">const</span> Point&amp; a1, <span class="keyword">const</span> Point&amp; a2, <span class="keyword">const</span> Point&amp; b1, <span class="keyword">const</span> Point&amp; b2)</span> </span>&#123;</div><div class="line">    <span class="comment">//若允许在端点处相交，可适当关闭下面的注释</span></div><div class="line">    <span class="comment">//if (isOnSegment(a1, b1, b2) || isOnSegment(a2, b1, b2) || isOnSegment(b1, a1, a2) || isOnSegment(b2, a1, a2)) return true;</span></div><div class="line">    <span class="keyword">double</span> c1 = Cross(a2-a1, b1-a1), c2 = Cross(a2-a1, b2-a1);</div><div class="line">    <span class="keyword">double</span> c3 = Cross(b2-b1, a1-b1), c4 = Cross(b2-b1, a2-b1);</div><div class="line">    <span class="keyword">return</span> dcmp(c1)*dcmp(c2) &lt; <span class="number">0</span> &amp;&amp; dcmp(c3)*dcmp(c4) &lt; <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//多边形的有向面积</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">PolygonArea</span><span class="params">(Polygon po)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = po.size();</div><div class="line">    <span class="keyword">double</span> area = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n<span class="number">-1</span>; i++) &#123;</div><div class="line">        area += Cross(po[i]-po[<span class="number">0</span>], po[i+<span class="number">1</span>]-po[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> area * <span class="number">0.5</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点在多边形内的判定(多边形顶点需按逆时针排列)</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isInPolygon</span><span class="params">(<span class="keyword">const</span> Point&amp; p, <span class="keyword">const</span> Polygon&amp; poly)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = poly.size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="comment">//若允许点在多边形边上，可关闭下行注释</span></div><div class="line">        <span class="comment">// if (isOnSegment(p, poly[(i+1)%n], poly[i])) return true;</span></div><div class="line">        <span class="keyword">if</span> (Cross(poly[(i+<span class="number">1</span>)%n]-poly[i], p-poly[i]) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//过定点作圆的切线</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTangents</span><span class="params">(<span class="keyword">const</span> Point&amp; P, <span class="keyword">const</span> Circle&amp; C, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Line&gt;&amp; L)</span> </span>&#123;</div><div class="line">    Vector u = C.c - P;</div><div class="line">    <span class="keyword">double</span> dis = Length(u);</div><div class="line">    <span class="keyword">if</span> (dcmp(dis - C.r) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (dcmp(dis - C.r) == <span class="number">0</span>) &#123;</div><div class="line">        L.push_back(Line(P, Rotate(u, PI / <span class="number">2.0</span>)));</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">double</span> ang = <span class="built_in">asin</span>(C.r / dis);</div><div class="line">    L.push_back(Line(P, Rotate(u, ang)));</div><div class="line">    L.push_back(Line(P, Rotate(u, -ang)));</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//直线和圆的交点</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetLineCircleIntersection</span><span class="params">(Line&amp; L, <span class="keyword">const</span> Circle&amp; C, <span class="built_in">vector</span>&lt;Point&gt;&amp; sol)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> t1, t2;</div><div class="line">    <span class="keyword">double</span> a = L.dir.x, b = L.P.x - C.c.x, c = L.dir.y, d = L.P.y - C.c.y;</div><div class="line">    <span class="keyword">double</span> e = a*a + c*c, f = <span class="number">2.0</span>*(a*b + c*d), g = b*b + d*d - C.r*C.r;</div><div class="line">    <span class="keyword">double</span> delta = f*f - <span class="number">4</span>*e*g; <span class="comment">//判别式</span></div><div class="line">    <span class="keyword">if</span> (dcmp(delta) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">//相离</span></div><div class="line">    <span class="keyword">if</span> (dcmp(delta) == <span class="number">0</span>) &#123; <span class="comment">//相切</span></div><div class="line">      t1 = t2 = -f / (<span class="number">2</span> * e);</div><div class="line">      sol.push_back(L.point(t1));</div><div class="line">      <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    t1 = (-f - <span class="built_in">sqrt</span>(delta)) / (<span class="number">2.0</span> * e); sol.push_back(L.point(t1));    <span class="comment">// 相交</span></div><div class="line">    t2 = (-f + <span class="built_in">sqrt</span>(delta)) / (<span class="number">2.0</span> * e); sol.push_back(L.point(t2));</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//两圆位置关系判定</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetCircleLocationRelation</span><span class="params">(<span class="keyword">const</span> Circle&amp; A, <span class="keyword">const</span> Circle&amp; B)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> d = Length(A.c-B.c);</div><div class="line">    <span class="keyword">double</span> sum = A.r + B.r;</div><div class="line">    <span class="keyword">double</span> sub = <span class="built_in">fabs</span>(A.r - B.r);</div><div class="line">    <span class="keyword">if</span> (dcmp(d) == <span class="number">0</span>) <span class="keyword">return</span> dcmp(sub) != <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (dcmp(d - sum) &gt; <span class="number">0</span>) <span class="keyword">return</span> XiangLi;</div><div class="line">    <span class="keyword">if</span> (dcmp(d - sum) == <span class="number">0</span>) <span class="keyword">return</span> WaiQie;</div><div class="line">    <span class="keyword">if</span> (dcmp(d - sub) &gt; <span class="number">0</span> &amp;&amp; dcmp(d - sum) &lt; <span class="number">0</span>) <span class="keyword">return</span> INTERSECTING;</div><div class="line">    <span class="keyword">if</span> (dcmp(d - sub) == <span class="number">0</span>) <span class="keyword">return</span> NeiQie;</div><div class="line">    <span class="keyword">if</span> (dcmp(d - sub) &lt; <span class="number">0</span>) <span class="keyword">return</span> NeiHan;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//两圆相交的面积</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">GetCircleIntersectionArea</span><span class="params">(<span class="keyword">const</span> Circle&amp; A, <span class="keyword">const</span> Circle&amp; B)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> rel = GetCircleLocationRelation(A, B);</div><div class="line">    <span class="keyword">if</span> (rel &lt; INTERSECTING) <span class="keyword">return</span> min(A.area(), B.area());</div><div class="line">    <span class="keyword">if</span> (rel &gt; INTERSECTING) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">double</span> dis = Length(A.c - B.c);</div><div class="line">    <span class="keyword">double</span> ang1 = <span class="built_in">acos</span>((A.r*A.r + dis*dis - B.r*B.r) / (<span class="number">2.0</span>*A.r*dis));</div><div class="line">    <span class="keyword">double</span> ang2 = <span class="built_in">acos</span>((B.r*B.r + dis*dis - A.r*A.r) / (<span class="number">2.0</span>*B.r*dis));</div><div class="line">    <span class="keyword">return</span> ang1*A.r*A.r + ang2*B.r*B.r - A.r*dis*<span class="built_in">sin</span>(ang1);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//凸包(Andrew算法)</span></div><div class="line"><span class="comment">//如果不希望在凸包的边上有输入点，把两个 &lt;= 改成 &lt;</span></div><div class="line"><span class="comment">//如果不介意点集被修改，可以改成传递引用</span></div><div class="line"><span class="function">Polygon <span class="title">ConvexHull</span><span class="params">(<span class="built_in">vector</span>&lt;Point&gt; p)</span> </span>&#123;</div><div class="line">    <span class="comment">//预处理，删除重复点</span></div><div class="line">    sort(p.begin(), p.end());</div><div class="line">    p.erase(unique(p.begin(), p.end()), p.end());</div><div class="line">    <span class="keyword">int</span> n = p.size(), m = <span class="number">0</span>;</div><div class="line">    <span class="function">Polygon <span class="title">res</span><span class="params">(n+<span class="number">1</span>)</span></span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(m &gt; <span class="number">1</span> &amp;&amp; Cross(res[m<span class="number">-1</span>]-res[m<span class="number">-2</span>], p[i]-res[m<span class="number">-2</span>]) &lt;= <span class="number">0</span>) m--;</div><div class="line">        res[m++] = p[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> k = m;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">while</span>(m &gt; k &amp;&amp; Cross(res[m<span class="number">-1</span>]-res[m<span class="number">-2</span>], p[i]-res[m<span class="number">-2</span>]) &lt;= <span class="number">0</span>) m--;</div><div class="line">        res[m++] = p[i];</div><div class="line">    &#125;</div><div class="line">    m -= n &gt; <span class="number">1</span>;</div><div class="line">    res.resize(m);</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点P在有向直线L左边的判定(线上不算)</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isOnLeft</span><span class="params">(<span class="keyword">const</span> Line&amp; L, <span class="keyword">const</span> Point&amp; P)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> Cross(L.dir, P-L.P) &gt; <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//半平面交主过程</span></div><div class="line"><span class="comment">//如果不介意点集被修改，可以改成传递引用</span></div><div class="line"><span class="function">Polygon <span class="title">HalfPlaneIntersection</span><span class="params">(<span class="built_in">vector</span>&lt;Line&gt; L)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = L.size();</div><div class="line">    <span class="keyword">int</span> head, rear;     <span class="comment">//双端队列的第一个元素和最后一个元素的下标</span></div><div class="line">    <span class="built_in">vector</span>&lt;Point&gt; p(n); <span class="comment">//p[i]为q[i]和q[i+1]的交点</span></div><div class="line">    <span class="built_in">vector</span>&lt;Line&gt; q(n);  <span class="comment">//双端队列</span></div><div class="line">    Polygon ans;</div><div class="line"></div><div class="line">    sort(L.begin(), L.end());   <span class="comment">//按极角排序</span></div><div class="line">    q[head=rear=<span class="number">0</span>] = L[<span class="number">0</span>];  <span class="comment">//双端队列初始化为只有一个半平面L[0]</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(head &lt; rear &amp;&amp; !isOnLeft(L[i], p[rear<span class="number">-1</span>])) rear--;</div><div class="line">        <span class="keyword">while</span>(head &lt; rear &amp;&amp; !isOnLeft(L[i], p[head])) head++;</div><div class="line">        q[++rear] = L[i];</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(Cross(q[rear].dir, q[rear<span class="number">-1</span>].dir)) &lt; eps) &#123;    <span class="comment">//两向量平行且同向，取内侧的一个</span></div><div class="line">            rear--;</div><div class="line">            <span class="keyword">if</span> (isOnLeft(q[rear], L[i].P)) q[rear] = L[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (head &lt; rear) p[rear<span class="number">-1</span>] = GetLineIntersection(q[rear<span class="number">-1</span>], q[rear]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(head &lt; rear &amp;&amp; !isOnLeft(q[head], p[rear<span class="number">-1</span>])) rear--; <span class="comment">//删除无用平面</span></div><div class="line">    <span class="keyword">if</span> (rear - head &lt;= <span class="number">1</span>) <span class="keyword">return</span> ans;   <span class="comment">//空集</span></div><div class="line">    p[rear] = GetLineIntersection(q[rear], q[head]);    <span class="comment">//计算首尾两个半平面的交点</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head; i &lt;= rear; i++) &#123; <span class="comment">//从deque复制到输出中</span></div><div class="line">        ans.push_back(p[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></div><div class="line">    freopen(<span class="string">"D:\\Documents\\Disk_Synchronous\\Programs\\Acm\\input.txt"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    <span class="keyword">double</span> a, b, c;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span> &gt;&gt; a &gt;&gt; b &gt;&gt; c) &#123;</div><div class="line">        <span class="keyword">if</span> (!isTriangle(a, b, c)) &#123;</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"-1.000"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">double</span> p = (a+b+c) / <span class="number">2</span>;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.3lf\n"</span>, <span class="built_in">sqrt</span>(p*(p-a)*(p-b)*(p-c)+eps)*<span class="number">4</span>/<span class="number">3</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/收集的一些ACM相关的模板/" rel="tag"># 收集的一些ACM相关的模板</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/02/HDU-6058/" rel="next" title="HDU 6058">
                <i class="fa fa-chevron-left"></i> HDU 6058
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="mostshy" />
          <p class="site-author-name" itemprop="name">mostshy</p>
           
              <p class="site-description motion-element" itemprop="description">或许这就是弱渣吧</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ACM模板"><span class="nav-number">1.</span> <span class="nav-text">ACM模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AC自动机"><span class="nav-number">1.0.1.</span> <span class="nav-text">AC自动机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CDQ分治"><span class="nav-number">1.1.</span> <span class="nav-text">CDQ分治</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LCA"><span class="nav-number">1.1.1.</span> <span class="nav-text">LCA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCA倍增法"><span class="nav-number">1.1.2.</span> <span class="nav-text">LCA倍增法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#刘汝佳计算几何模板"><span class="nav-number">1.1.3.</span> <span class="nav-text">刘汝佳计算几何模板</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mostshy</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
