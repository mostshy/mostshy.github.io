<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="收集的一些ACM相关的模板," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="整理的一些常用的ACM模板">
<meta name="keywords" content="收集的一些ACM相关的模板">
<meta property="og:type" content="article">
<meta property="og:title" content="ACM模板">
<meta property="og:url" content="http://yoursite.com/2017/08/02/ACM模板/index.html">
<meta property="og:site_name" content="mostshy&#39;Blog">
<meta property="og:description" content="整理的一些常用的ACM模板">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-02T09:30:53.873Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ACM模板">
<meta name="twitter:description" content="整理的一些常用的ACM模板">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/08/02/ACM模板/"/>





  <title>ACM模板 | mostshy'Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mostshy'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I good vegetable a.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/02/ACM模板/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mostshy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mostshy'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ACM模板</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-02T02:11:09+08:00">
                2017-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ACM/" itemprop="url" rel="index">
                    <span itemprop="name">ACM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><blockquote class="blockquote-center"><h2>整理的一些常用的ACM模板</h2></blockquote><br><a id="more"></a></p>
<h3 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxnode=<span class="number">11000</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> sigma_size=<span class="number">26</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC_Automata</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> ch[maxnode][sigma_size];</div><div class="line">    <span class="keyword">int</span> val[maxnode];   <span class="comment">// 每个字符串的结尾结点都有一个非0的val</span></div><div class="line">    <span class="keyword">int</span> f[maxnode];     <span class="comment">// fail函数</span></div><div class="line">    <span class="keyword">int</span> last[maxnode];  <span class="comment">// last[i]=j表j节点表示的单词是i节点单词的后缀，且j节点是单词节点</span></div><div class="line">    <span class="keyword">int</span> sz;</div><div class="line"></div><div class="line">    <span class="comment">//初始化0号根节点的相关信息</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        sz=<span class="number">1</span>;</div><div class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>],<span class="number">0</span>,<span class="keyword">sizeof</span>(ch[<span class="number">0</span>]));</div><div class="line">        val[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//insert负责构造ch与val数组</span></div><div class="line">    <span class="comment">//插入字符串,v必须非0表示一个单词节点</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">int</span> v)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s),u=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> id=s[i]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">if</span>(ch[u][id]==<span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                ch[u][id]=sz;</div><div class="line">                <span class="built_in">memset</span>(ch[sz],<span class="number">0</span>,<span class="keyword">sizeof</span>(ch[sz]));</div><div class="line">                val[sz++]=<span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            u=ch[u][id];</div><div class="line">        &#125;</div><div class="line">        val[u]=v;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//getFail函数负责构造f和last数组</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</div><div class="line">        last[<span class="number">0</span>]=f[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;sigma_size; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> u=ch[<span class="number">0</span>][i];</div><div class="line">            <span class="keyword">if</span>(u)</div><div class="line">            &#123;</div><div class="line">                f[u]=last[u]=<span class="number">0</span>;</div><div class="line">                q.push(u);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">while</span>(!q.empty())<span class="comment">// 按BFS顺序计算fail</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> r=q.front(); q.pop();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;sigma_size; i++)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">int</span> u=ch[r][i];</div><div class="line">                <span class="keyword">if</span>(u==<span class="number">0</span>)<span class="keyword">continue</span>;</div><div class="line">                q.push(u);</div><div class="line"></div><div class="line">                <span class="keyword">int</span> v=f[r];</div><div class="line">                <span class="keyword">while</span>(v &amp;&amp; ch[v][i]==<span class="number">0</span>) v=f[v];</div><div class="line">                f[u]= ch[v][i];</div><div class="line">                last[u] =  val[f[u]]?f[u]:last[f[u]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//递归打印与结点i后缀相同的前缀节点编号</span></div><div class="line">    <span class="comment">//进入此函数前需保证val[i]&gt;0</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> i)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(i)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i);</div><div class="line">            print(last[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 在s中找出 出现了哪几个模板单词</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">(<span class="keyword">char</span> *s)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s),j=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> id=s[i]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">while</span>(j &amp;&amp; ch[j][id]==<span class="number">0</span>) j=f[j];</div><div class="line">            j=ch[j][id];</div><div class="line">            <span class="keyword">if</span>(val[j]) print(j);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(last[j]) print(last[j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;;</div><div class="line">AC_Automata ac;</div></pre></td></tr></table></figure>
<h3 id="CDQ分治"><a href="#CDQ分治" class="headerlink" title="CDQ分治"></a>CDQ分治</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">平面上有N个点，每个点的横纵坐标在[0,1e7]之间，有M个询问，每个询问为查询在指定矩形之内有多少个点，</div><div class="line">矩形用(x1,y1,x2,y2)的方式给出，其中(x1,y1)为左下角坐标，(x2,y2)为右上角坐标。</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">500001</span>; <span class="comment">// 点的数量</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">500001</span>; <span class="comment">// 询问数量</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = MAXN+(MAXM&lt;&lt;<span class="number">2</span>);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">10000002</span>; <span class="comment">// 树状数组大小</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> n, m, maxy = <span class="number">-1</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> IO &#123; <span class="comment">// 快读相关</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> BUFSZ = <span class="number">1e7</span>;</div><div class="line">    <span class="keyword">char</span> buf[BUFSZ]; <span class="keyword">int</span> idx, end;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; idx = BUFSZ; &#125;</div><div class="line">    <span class="function"><span class="keyword">char</span> <span class="title">getch</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>( idx == BUFSZ ) &#123;</div><div class="line">            end = fread( buf, <span class="number">1</span>, BUFSZ, <span class="built_in">stdin</span> ); idx = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>( idx == end ) <span class="keyword">return</span> EOF;</div><div class="line">        <span class="keyword">return</span> buf[idx++];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getint</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> num = <span class="number">0</span>; <span class="keyword">char</span> ch;</div><div class="line">        <span class="keyword">while</span>( <span class="built_in">isspace</span>(ch=getch()) );</div><div class="line">        <span class="keyword">do</span> &#123; num = num*<span class="number">10</span> + ch-<span class="string">'0'</span>; &#125; <span class="keyword">while</span>( <span class="built_in">isdigit</span>(ch=getch()) );</div><div class="line">        <span class="keyword">return</span> num;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">using</span> IO::getint;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> type, x, y, w, aid; <span class="comment">// w表示对查询结果贡献(+还是-)，aid是“第几个查询”</span></div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;( <span class="keyword">const</span> Query &amp;rhs ) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> x == rhs.x ? type &lt; rhs.type : x &lt; rhs.x;</div><div class="line">    &#125;</div><div class="line">&#125;query[MAXQ];</div><div class="line"><span class="keyword">int</span> qidx = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addq</span><span class="params">( <span class="keyword">int</span> type, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> aid )</span> </span>&#123;</div><div class="line">    query[qidx++] = (Query)&#123;type,x,y,w,aid&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> ans[MAXM], aidx = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> BIT &#123; <span class="comment">// 树状数组相关</span></div><div class="line">    <span class="keyword">int</span> arr[MAXL];</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">( <span class="keyword">int</span> num )</span> </span>&#123; <span class="keyword">return</span> num&amp;(-num); &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( <span class="keyword">int</span> idx, <span class="keyword">int</span> val )</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>( idx &lt;= maxy ) &#123;</div><div class="line">            arr[idx] += val;</div><div class="line">            idx += lowbit(idx);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">( <span class="keyword">int</span> idx )</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>( idx ) &#123;</div><div class="line">            ans += arr[idx];</div><div class="line">            idx -= lowbit(idx);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ans;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">( <span class="keyword">int</span> idx )</span></span>&#123;</div><div class="line">        <span class="keyword">while</span>( idx &lt;= maxy ) &#123;</div><div class="line">            <span class="keyword">if</span>( arr[idx] ) arr[idx] = <span class="number">0</span>; <span class="keyword">else</span> <span class="keyword">break</span>;</div><div class="line">            idx += lowbit(idx);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Query tmp[MAXQ];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">( <span class="keyword">int</span> L, <span class="keyword">int</span> R )</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>( R-L &lt;= <span class="number">1</span> ) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> M = (L+R)&gt;&gt;<span class="number">1</span>; cdq(L,M); cdq(M,R);</div><div class="line">    <span class="keyword">int</span> p = L, q = M, o = L;</div><div class="line">    <span class="keyword">while</span>( p &lt; M &amp;&amp; q &lt; R ) &#123;</div><div class="line">        <span class="keyword">if</span>( query[p] &lt; query[q] ) &#123;</div><div class="line">            <span class="keyword">if</span>( query[p].type == <span class="number">0</span> ) BIT::add( query[p].y, <span class="number">1</span> );</div><div class="line">            tmp[o++] = query[p++];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>( query[q].type == <span class="number">1</span> ) ans[query[q].aid] += query[q].w * BIT::query( query[q].y );</div><div class="line">            tmp[o++] = query[q++];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>( p &lt; M ) tmp[o++] = query[p++];</div><div class="line">    <span class="keyword">while</span>( q &lt; R ) &#123;</div><div class="line">        <span class="keyword">if</span>( query[q].type == <span class="number">1</span> ) ans[query[q].aid] += query[q].w * BIT::query( query[q].y );</div><div class="line">        tmp[o++] = query[q++];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = L; i &lt; R; ++i ) &#123;</div><div class="line">        BIT::clear( tmp[i].y ); <span class="comment">// 清空树状数组</span></div><div class="line">        query[i] = tmp[i];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    IO::init(); n = getint(); m = getint();</div><div class="line">    <span class="keyword">while</span>( n-- ) &#123;</div><div class="line">        <span class="keyword">int</span> x,y; x = getint(); y = getint(); ++x; ++y; <span class="comment">// 为了方便，把坐标转化为[1,1e7+1]</span></div><div class="line">        addq(<span class="number">0</span>,x,y,<span class="number">0</span>,<span class="number">0</span>); maxy = max( maxy, y ); <span class="comment">// 修改操作无附加信息</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>( m-- ) &#123;</div><div class="line">        <span class="keyword">int</span> x1,y1,x2,y2; x1 = getint(); y1 = getint(); x2 = getint(); y2 = getint(); ++x1; ++y1; ++x2; ++y2;</div><div class="line">        addq(<span class="number">1</span>,x1<span class="number">-1</span>,y1<span class="number">-1</span>,<span class="number">1</span>,aidx); addq(<span class="number">1</span>,x1<span class="number">-1</span>,y2,<span class="number">-1</span>,aidx); addq(<span class="number">1</span>,x2,y1<span class="number">-1</span>,<span class="number">-1</span>,aidx); addq(<span class="number">1</span>,x2,y2,<span class="number">1</span>,aidx); ++aidx;</div><div class="line">        maxy = max( maxy, max(y1,y2) );</div><div class="line">    &#125;</div><div class="line">    cdq(<span class="number">0</span>,qidx);</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; aidx; ++i ) <span class="built_in">printf</span>( <span class="string">"%d\n"</span>, ans[i] );</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="CDQ分治-斜率dp"><a href="#CDQ分治-斜率dp" class="headerlink" title="CDQ分治+斜率dp"></a>CDQ分治+斜率dp</h4>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">dp[i]=min&#123;dp[j]+(S+T[i]-T[j])*F[i]&#125;;</div><div class="line">dp[j]=F[i]*T[j]+dp[i]-(S+T[i])*F[i];</div><div class="line">令y=dp[j],x=T[j],k=F[i];</div><div class="line">则要让dp[i]最小，则斜率为k的直线切y轴最小</div><div class="line">维护下凸包</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 300010</span></div><div class="line"><span class="keyword">int</span> t[maxn],f[maxn],st[maxn],S;</div><div class="line">ll T[maxn],F[maxn],ans[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">query</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> p,x;</div><div class="line">    ll y,k;</div><div class="line">    query() &#123;</div><div class="line">        y=<span class="number">1e18</span>;</div><div class="line">    &#125;</div><div class="line">    query(<span class="keyword">int</span> p,<span class="keyword">int</span> x,ll y,ll k):p(p),x(x),y(y),k(k) &#123;&#125;</div><div class="line">&#125; q[maxn],q1[maxn],q2[maxn];</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">getk</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(q[i].x==q[j].x&amp;&amp;q[i].y&lt;q[j].y) <span class="keyword">return</span> <span class="number">-1e18</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(q[i].x==q[j].x) <span class="keyword">return</span> <span class="number">1e18</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">1.0</span>*(q[i].y-q[j].y)/(q[i].x-q[j].x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(L&gt;R) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(L==R) &#123;</div><div class="line">        ans[q[L].p]=q[L].y;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> M=(L+R)/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=R; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(q[i].p&lt;=M) q1[a++]=q[i];</div><div class="line">        <span class="keyword">else</span> q2[b++]=q[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;L+a; i++) q[i]=q1[i-L];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L+a; i&lt;=R; i++) q[i]=q2[i-L-a];</div><div class="line">    cdq(L,M);</div><div class="line">    <span class="keyword">int</span> top=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=M; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(top&gt;<span class="number">1</span>&amp;&amp;getk(i,st[top<span class="number">-1</span>])&lt;=getk(st[top<span class="number">-1</span>],st[top<span class="number">-2</span>])) top--;</div><div class="line">        st[top++]=i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=M+<span class="number">1</span>; i&lt;=R; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(j&lt;top<span class="number">-1</span>&amp;&amp;(<span class="keyword">double</span>)q[i].k&gt;getk(st[j+<span class="number">1</span>],st[j])) j++;</div><div class="line">        <span class="keyword">int</span> k=st[j];</div><div class="line">        q[i].y=min(q[i].y,q[k].y+(S+T[q[i].p]-T[q[k].p])*F[q[i].p]);</div><div class="line"><span class="comment">//        printf("%d %d %d %lld\n",L,R,j,q[i].y);</span></div><div class="line">    &#125;</div><div class="line">    cdq(M+<span class="number">1</span>,R);</div><div class="line">    a=L;</div><div class="line">    b=M+<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> o=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(a&lt;=M&amp;&amp;b&lt;=R) &#123;</div><div class="line">        <span class="keyword">if</span>(q[a].x&lt;q[b].x) q1[o++]=q[a++];</div><div class="line">        <span class="keyword">else</span> q1[o++]=q[b++];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(a&lt;=M) q1[o++]=q[a++];</div><div class="line">    <span class="keyword">while</span>(b&lt;=R) q1[o++]=q[b++];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L; i&lt;=R; i++) &#123;</div><div class="line">        q[i]=q1[i-L];</div><div class="line"><span class="comment">//        printf("**%d\n",q[i].x);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> query &amp;a,<span class="keyword">const</span> query &amp;b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.k&lt;b.k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//    freopen("data.txt","r",stdin);</span></div><div class="line"><span class="comment">//    freopen("ans.txt","w",stdout);</span></div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;S);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;t[i],&amp;f[i]);</div><div class="line">    q[<span class="number">0</span>]=query(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n+<span class="number">10</span>; i++) q[i].y=<span class="number">1e18</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        T[i]=T[i<span class="number">-1</span>]+t[n-i+<span class="number">1</span>];</div><div class="line">        F[i]=F[i<span class="number">-1</span>]+(ll)f[n-i+<span class="number">1</span>];</div><div class="line">        q[i].p=i;</div><div class="line">        q[i].x=T[i];</div><div class="line">        q[i].k=F[i];</div><div class="line">    &#125;</div><div class="line"><span class="comment">//    sort(q,q+n+1,cmp);</span></div><div class="line">    cdq(<span class="number">0</span>,n);</div><div class="line"><span class="comment">//    for(int i=0;i&lt;=n;i++)</span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans[n]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">5 1</div><div class="line">0 2</div><div class="line">2 2</div><div class="line">1 2</div><div class="line">0 2</div><div class="line">-2 2</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h3><h4 id="RMQ法"><a href="#RMQ法" class="headerlink" title="RMQ法"></a>RMQ法</h4>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100010</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> to,cost;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;node&gt; g[maxn];</div><div class="line"><span class="keyword">int</span> ver[<span class="number">2</span>*maxn],id[<span class="number">2</span>*maxn],first[maxn];</div><div class="line"><span class="keyword">int</span> dis[maxn];;</div><div class="line"><span class="comment">//  ver[i] : i 对应的节点编号</span></div><div class="line"><span class="comment">//  id[i] :  i 对应节点深度</span></div><div class="line"><span class="keyword">int</span> tot,n,q;</div><div class="line"><span class="keyword">int</span> dp[<span class="number">2</span>*maxn][<span class="number">30</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> dep,<span class="keyword">int</span> s,<span class="keyword">int</span> fa)</span></span>&#123;</div><div class="line">    ver[++tot]=root;id[tot]=dep;first[root]=tot;dis[root]=s;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;g[root].size();i++)&#123;</div><div class="line">        <span class="keyword">int</span> v=g[root][i].to,w=g[root][i].cost;</div><div class="line">        <span class="keyword">if</span>(v==fa) <span class="keyword">continue</span>;</div><div class="line">        dfs(v,dep+<span class="number">1</span>,s+w,root);</div><div class="line">        ver[++tot]=root;id[tot]=dep;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ST</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tot;i++)</div><div class="line">        dp[i][<span class="number">0</span>]=i;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j)&lt;=tot;j++)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=tot;i++)&#123;</div><div class="line">            <span class="keyword">int</span> a=dp[i][j<span class="number">-1</span>],b=dp[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>];</div><div class="line">            dp[i][j]=id[a]&lt;id[b]?a:b;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">RMQ</span><span class="params">(<span class="keyword">int</span> le,<span class="keyword">int</span> ri)</span></span>&#123;</div><div class="line">    le=first[le],ri=first[ri];</div><div class="line">    <span class="keyword">if</span>(le&gt;ri) swap(le,ri);</div><div class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;(k+<span class="number">1</span>))&lt;=ri-le+<span class="number">1</span>) k++;</div><div class="line">    <span class="keyword">int</span> a=dp[le][k],b=dp[ri-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k];</div><div class="line">    <span class="keyword">return</span> id[a]&lt;id[b]?ver[a]:ver[b];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> ca,kase=<span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;ca);</div><div class="line">    <span class="keyword">while</span>(ca--)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;maxn;i++) g[i].clear();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</div><div class="line">        <span class="keyword">int</span> u,v,w;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;u,&amp;v,&amp;w);</div><div class="line">            g[u].push_back((node)&#123;v,w&#125;);</div><div class="line">            g[v].push_back((node)&#123;u,w&#125;);</div><div class="line">        &#125;</div><div class="line">        tot=<span class="number">0</span>;dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>);</div><div class="line">        ST();</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="LCA倍增法"><a href="#LCA倍增法" class="headerlink" title="LCA倍增法"></a>LCA倍增法</h4>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> DFS预处理出所有节点的深度和父节点</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span>(i=head[u]; i!=<span class="number">-1</span>; i=next[i]) &#123;</div><div class="line">        <span class="keyword">if</span> (!deep[to[i]]) &#123;</div><div class="line">            deep[to[i]] = deep[u]+<span class="number">1</span>;</div><div class="line">            p[to[i]][<span class="number">0</span>] = u; <span class="comment">//p[x][0]保存x的父节点为u;</span></div><div class="line">            dfs(to[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="number">2.</span> 初始各个点的<span class="number">2</span>^j祖先是谁 ,其中 <span class="number">2</span>^j (j =<span class="number">0.</span>..<span class="built_in">log</span>(该点深度))倍祖先，<span class="number">1</span>倍祖先就是父亲，<span class="number">2</span>倍祖先是父亲的父亲......。</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="comment">//p[i][j]表示i结点的第2^j祖先</span></div><div class="line">    <span class="keyword">for</span>(j=<span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j)&lt;=n; j++)</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>; i&lt;=n; i++)</div><div class="line">            <span class="keyword">if</span>(p[i][j<span class="number">-1</span>]!=<span class="number">-1</span>)</div><div class="line">                p[i][j]=p[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];<span class="comment">//i的第2^j祖先就是i的第2^(j-1)祖先的第2^(j-1)祖先</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="number">3.</span>从深度大的节点上升至深度小的节点同层，如果此时两节点相同直接返回此节点，即lca。</div><div class="line"></div><div class="line">否则，利用倍增法找到最小深度的 p[a][j]!=p[b][j]，此时他们的父亲p[a][<span class="number">0</span>]即lca。</div><div class="line"></div><div class="line"><span class="keyword">int</span> lca(<span class="keyword">int</span> a,<span class="keyword">int</span> b) &#123; <span class="comment">//最近公共祖先</span></div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">if</span>(deep[a]&lt;deep[b])swap(a,b);</div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; (<span class="number">1</span>&lt;&lt;i)&lt;=deep[a]; i++);</div><div class="line">    i--;</div><div class="line">    <span class="comment">//使a，b两点的深度相同</span></div><div class="line">    <span class="keyword">for</span>(j=i; j&gt;=<span class="number">0</span>; j--)</div><div class="line">        <span class="keyword">if</span>(deep[a]-(<span class="number">1</span>&lt;&lt;j)&gt;=deep[b])</div><div class="line">            a=p[a][j];</div><div class="line">    <span class="keyword">if</span>(a==b)<span class="keyword">return</span> a;</div><div class="line">    <span class="comment">//倍增法，每次向上进深度2^j，找到最近公共祖先的子结点</span></div><div class="line">    <span class="keyword">for</span>(j=i; j&gt;=<span class="number">0</span>; j--) &#123;</div><div class="line">        <span class="keyword">if</span>(p[a][j]!=<span class="number">-1</span>&amp;&amp;p[a][j]!=p[b][j]) &#123;</div><div class="line">            a=p[a][j];</div><div class="line">            b=p[b][j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> p[a][<span class="number">0</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//给出一个只由小写英文字符a,b,c...y,z组成的字符串S,求S中最长回文串的长度. </span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">110010</span>;</div><div class="line"><span class="keyword">char</span> Ma[MAXN*<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> Mp[MAXN*<span class="number">2</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Manacher</span><span class="params">(<span class="keyword">char</span> s[],<span class="keyword">int</span> len)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> l=<span class="number">0</span>;</div><div class="line">    Ma[l++]=<span class="string">'$'</span>;</div><div class="line">    Ma[l++]=<span class="string">'#'</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        Ma[l++]=s[i];</div><div class="line">        Ma[l++]=<span class="string">'#'</span>;</div><div class="line">    &#125;</div><div class="line">    Ma[l]=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> mx=<span class="number">0</span>,id=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;l; i++) &#123;</div><div class="line">        Mp[i]=mx&gt;i?min(Mp[<span class="number">2</span>*id-i],mx-i):<span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span>(Ma[i+Mp[i]]==Ma[i-Mp[i]])Mp[i]++;</div><div class="line">        <span class="keyword">if</span>(i+Mp[i]&gt;mx) &#123;</div><div class="line">            mx=i+Mp[i];</div><div class="line">            id=i;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> s[MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s)==<span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s);</div><div class="line">        Manacher(s,len);</div><div class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>*len+<span class="number">2</span>; i++)</div><div class="line">            ans=max(ans,Mp[i]<span class="number">-1</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SBTree"><a href="#SBTree" class="headerlink" title="SBTree"></a>SBTree</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">10005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF=<span class="number">0x7FFFFFFF</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> ERROR=<span class="number">-0x3f3f3f3f</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SBT</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> key,left,right,size;</div><div class="line">    SBT() &#123;</div><div class="line">        key=left=right=size=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125; tree[N];</div><div class="line"></div><div class="line"><span class="keyword">int</span> root,top;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">left_rot</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y = tree[x].right;</div><div class="line">    tree[x].right = tree[y].left;</div><div class="line">    tree[y].left = x;</div><div class="line">    tree[y].size = tree[x].size;<span class="comment">//转上去的节点数量为先前此处节点的size</span></div><div class="line">    tree[x].size = tree[tree[x].left].size + tree[tree[x].right].size + <span class="number">1</span>;</div><div class="line">    x = y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">right_rot</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y = tree[x].left;</div><div class="line">    tree[x].left = tree[y].right;</div><div class="line">    tree[y].right = x;</div><div class="line">    tree[y].size = tree[x].size;</div><div class="line">    tree[x].size = tree[tree[x].left].size + tree[tree[x].right].size + <span class="number">1</span>;</div><div class="line">    x = y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">bool</span> flag)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(flag == <span class="literal">false</span>) &#123; <span class="comment">//左边</span></div><div class="line">        <span class="keyword">if</span>(tree[tree[tree[x].left].left].size &gt; tree[tree[x].right].size)<span class="comment">//左孩子的左子树大于右孩子</span></div><div class="line">            right_rot(x);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tree[tree[tree[x].left].right].size &gt; tree[tree[x].right].size) &#123; <span class="comment">//右孩子的右子树大于右孩子</span></div><div class="line">            left_rot(tree[x].left);</div><div class="line">            right_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//右边</span></div><div class="line">        <span class="keyword">if</span>(tree[tree[tree[x].right].right].size &gt; tree[tree[x].left].size)<span class="comment">//右孩子的右子树大于左孩子</span></div><div class="line">            left_rot(x);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tree[tree[tree[x].right].left].size &gt; tree[tree[x].left].size) &#123; <span class="comment">//右孩子的左子树大于左孩子</span></div><div class="line">            right_rot(tree[x].right);</div><div class="line">            left_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    maintain(tree[x].left,<span class="literal">false</span>);</div><div class="line">    maintain(tree[x].right,<span class="literal">true</span>);</div><div class="line">    maintain(x,<span class="literal">true</span>);</div><div class="line">    maintain(x,<span class="literal">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">*insert没有合并相同的元素，如果出现相同的元素则把它放到右子树上，这样能保证求第k小数的时候对相同元素也能正确</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) &#123;</div><div class="line">        x = ++top;</div><div class="line">        tree[x].left = tree[x].right = <span class="number">0</span>;</div><div class="line">        tree[x].size = <span class="number">1</span>;</div><div class="line">        tree[x].key = key;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        tree[x].size ++;</div><div class="line">        <span class="keyword">if</span>(key &lt; tree[x].key) insert(tree[x].left,key);</div><div class="line">        <span class="keyword">else</span>  insert(tree[x].right,key);<span class="comment">//相同元素插入到右子树中</span></div><div class="line">        maintain(x, key &gt;= tree[x].key);<span class="comment">//每次插入把平衡操作压入栈中</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123;<span class="comment">//删除之前判断是否存在该元素</span></div><div class="line">    <span class="keyword">int</span> d_key;</div><div class="line"><span class="comment">//    if(!x) return 0;</span></div><div class="line">    tree[x].size --;</div><div class="line">    <span class="keyword">if</span>((key == tree[x].key)||(key &lt; tree[x].key &amp;&amp; tree[x].left == <span class="number">0</span>) ||</div><div class="line">            (key&gt;tree[x].key &amp;&amp; tree[x].right == <span class="number">0</span>)) &#123;</div><div class="line">        d_key = tree[x].key;</div><div class="line">        <span class="keyword">if</span>(tree[x].left &amp;&amp; tree[x].right) &#123;</div><div class="line">            tree[x].key = erase(tree[x].left,tree[x].key+<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            x = tree[x].left + tree[x].right;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(key &gt; tree[x].key)</div><div class="line">        d_key = erase(tree[x].right,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(key &lt; tree[x].key)</div><div class="line">        d_key = erase(tree[x].left,key);</div><div class="line">    <span class="keyword">return</span> d_key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">for</span>(x = root ; tree[x].left; x = tree[x].left);</div><div class="line">    <span class="keyword">return</span> tree[x].key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmax</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">for</span>(x = root ; tree[x].right; x = tree[x].right);</div><div class="line">    <span class="keyword">return</span> tree[x].key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Kth</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> k)</span> </span>&#123; <span class="comment">//求第k小数,有重复元素也不会出错</span></div><div class="line">    <span class="keyword">if</span>(x==<span class="number">0</span>||k&lt;=<span class="number">0</span>||k&gt;tree[x].size) <span class="keyword">return</span> ERROR;</div><div class="line">    <span class="keyword">int</span> r = tree[tree[x].left].size + <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(r == k) <span class="keyword">return</span> tree[x].key;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(r &lt; k) <span class="keyword">return</span> Kth(tree[x].right,k - r);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> Kth(tree[x].left,k);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Rank</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123; <span class="comment">//求key排第几,返回值范围在[1,num+1]范围内</span></div><div class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(key &lt;= tree[x].key)</div><div class="line">        <span class="keyword">return</span> Rank(tree[x].left,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> Rank(tree[x].right,key) + tree[tree[x].left].size + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pred</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y,<span class="keyword">int</span> key)</span> </span>&#123; <span class="comment">//前驱的下标 小于</span></div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(tree[x].key &lt; key)</div><div class="line">        <span class="keyword">return</span> pred(tree[x].right,x,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> pred(tree[x].left,y,key);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">succ</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y,<span class="keyword">int</span> key)</span> </span>&#123; <span class="comment">//后继的下标 大于</span></div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(tree[x].key &gt; key)</div><div class="line">        <span class="keyword">return</span> succ(tree[x].left,x,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> succ(tree[x].right,y,key);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">inorder</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x==<span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        inorder(tree[x].left);</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">" "</span>&lt;&lt;tree[x].key&lt;&lt;<span class="string">" "</span>&lt;&lt;<span class="string">" "</span>&lt;&lt;tree[x].size&lt;&lt;<span class="string">" "</span>&lt;&lt;tree[tree[x].left].key&lt;&lt;<span class="string">" "</span>&lt;&lt;tree[tree[x].right].key&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        inorder(tree[x].right);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(x) &#123;</div><div class="line">        <span class="keyword">if</span>(key==tree[x].key) <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//存在</span></div><div class="line">        <span class="keyword">if</span>(key&lt;tree[x].key) x=tree[x].left;</div><div class="line">        <span class="keyword">else</span> x=tree[x].right;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;              <span class="comment">//不存在</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> Rank(x,key+<span class="number">1</span>)-Rank(x,key);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    root = top = <span class="number">0</span>;</div><div class="line">    <span class="keyword">char</span> ch;</div><div class="line">    <span class="keyword">int</span> x,tmp;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%c %d"</span>,&amp;ch,&amp;x)) &#123;</div><div class="line">        <span class="keyword">switch</span>(ch) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'I'</span>:</div><div class="line">            insert(root,x);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'D'</span>:</div><div class="line">            erase(root,x);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'K'</span>:</div><div class="line">            tmp=Kth(root,x);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tmp);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'R'</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,Rank(root,x));</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'P'</span>:</div><div class="line">            tmp = pred(root,<span class="number">0</span>,x);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tree[tmp].key);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'S'</span>:</div><div class="line">            tmp = succ(root,<span class="number">0</span>,x);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tree[tmp].key);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'L'</span>:</div><div class="line">            inorder(root);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'C'</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,count(root,x));</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="splay"><a href="#splay" class="headerlink" title="splay"></a>splay</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  ll;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100010</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> a[maxn];</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    Node* ch[<span class="number">2</span>];</div><div class="line">    Node* par;</div><div class="line">    <span class="keyword">int</span> rank;<span class="comment">// 当前节点在序列中的位置</span></div><div class="line">    <span class="keyword">int</span> s;<span class="comment">// 节点总数</span></div><div class="line">    <span class="keyword">int</span> flip;<span class="comment">// 旋转标记</span></div><div class="line">    <span class="keyword">int</span> add;<span class="comment">// 增减标记</span></div><div class="line">    <span class="keyword">int</span> val;<span class="comment">// 节点的值</span></div><div class="line">    <span class="keyword">int</span> sum;</div><div class="line">    Node() &#123;</div><div class="line">        par=<span class="literal">NULL</span>;</div><div class="line">        rank=<span class="number">1</span>;</div><div class="line">        s=<span class="number">1</span>;</div><div class="line">        flip=<span class="number">0</span>;</div><div class="line">        add=<span class="number">0</span>;</div><div class="line">        sum=<span class="number">0</span>;</div><div class="line">        ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (x==rank) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        <span class="keyword">return</span> x&lt;rank? <span class="number">0</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span></span>&#123;</div><div class="line">        s=<span class="number">1</span>;</div><div class="line">        rank=<span class="number">1</span>;</div><div class="line">        sum=val;</div><div class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">            s+=ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            rank+=ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            sum+=ch[<span class="number">0</span>]-&gt;sum;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">            s+=ch[<span class="number">1</span>]-&gt;s;</div><div class="line">            sum+=ch[<span class="number">1</span>]-&gt;sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (flip) &#123;</div><div class="line">            flip=<span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">0</span>]-&gt;flip^=<span class="number">1</span>;</div><div class="line">                swap(ch[<span class="number">0</span>]-&gt;ch[<span class="number">0</span>],ch[<span class="number">0</span>]-&gt;ch[<span class="number">1</span>]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">1</span>]-&gt;flip^=<span class="number">1</span>;</div><div class="line">                swap(ch[<span class="number">1</span>]-&gt;ch[<span class="number">0</span>],ch[<span class="number">1</span>]-&gt;ch[<span class="number">1</span>]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (add) &#123;</div><div class="line">            <span class="keyword">if</span> (ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">0</span>]-&gt;val+=add;</div><div class="line">                ch[<span class="number">0</span>]-&gt;add+=add;</div><div class="line">                ch[<span class="number">0</span>]-&gt;sum+=add*ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">1</span>]-&gt;val+=add;</div><div class="line">                ch[<span class="number">1</span>]-&gt;add+=add;</div><div class="line">                ch[<span class="number">1</span>]-&gt;sum+=add*ch[<span class="number">1</span>]-&gt;s;</div><div class="line">            &#125;</div><div class="line">            add=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Node* root=<span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">    Node* k = o-&gt;ch[d^<span class="number">1</span>];</div><div class="line">    Node* par = o-&gt;par;</div><div class="line">    o-&gt;ch[d^<span class="number">1</span>] = k-&gt;ch[d];</div><div class="line">    <span class="keyword">if</span>(k-&gt;ch[d]) k-&gt;ch[d]-&gt;par=o;</div><div class="line">    k-&gt;ch[d] = o;</div><div class="line">    o-&gt;par=k;</div><div class="line">    k-&gt;par=par;</div><div class="line">    o-&gt;maintain();</div><div class="line">    k-&gt;maintain();</div><div class="line">    o=k;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="comment">//correct</span></div><div class="line">    o-&gt;pushdown();</div><div class="line">    o-&gt;maintain();</div><div class="line">    <span class="keyword">int</span> d= o-&gt;cmp(k);</div><div class="line">    <span class="keyword">if</span> (d==<span class="number">1</span>) k -= o-&gt;rank;</div><div class="line">    <span class="keyword">if</span> (d!=<span class="number">-1</span>) &#123;</div><div class="line">        Node* p = o-&gt;ch[d];</div><div class="line">        p-&gt;pushdown();</div><div class="line">        p-&gt;maintain();</div><div class="line">        <span class="keyword">int</span> d2 = p-&gt;cmp(k);</div><div class="line">        <span class="keyword">int</span> k2 = (d2==<span class="number">0</span> ? k : k-p-&gt;rank);</div><div class="line">        <span class="keyword">if</span> (d2!=<span class="number">-1</span>) &#123;</div><div class="line">            splay(p-&gt;ch[d2],k2);</div><div class="line">            <span class="keyword">if</span> (d==d2) rotate(o,d^<span class="number">1</span>);</div><div class="line">            <span class="keyword">else</span> rotate(o-&gt;ch[d], d);</div><div class="line">        &#125;</div><div class="line">        rotate(o,d^<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Rank</span><span class="params">(Node *o)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> cnt=o-&gt;rank;</div><div class="line">    <span class="keyword">while</span>(o-&gt;par)&#123;</div><div class="line">        <span class="keyword">if</span>(o-&gt;par-&gt;ch[<span class="number">1</span>]==o) cnt+=o-&gt;par-&gt;rank;</div><div class="line">        o=o-&gt;par;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> cnt<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//Node* id[maxn];</span></div><div class="line"><span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,Node *fa)</span> </span>&#123;</div><div class="line">    Node* p;</div><div class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    p=<span class="keyword">new</span> Node();</div><div class="line">    p-&gt;val=a[mid];</div><div class="line">    <span class="comment">//id[a[mid]]=p;</span></div><div class="line">    p-&gt;s=r-l+<span class="number">1</span>;</div><div class="line">    p-&gt;rank=mid-l+<span class="number">1</span>;</div><div class="line">    p-&gt;flip=<span class="number">0</span>;</div><div class="line">    p-&gt;add=<span class="number">0</span>;</div><div class="line">    p-&gt;par=fa;</div><div class="line">    p-&gt;ch[<span class="number">0</span>]=p-&gt;ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span> (mid<span class="number">-1</span>&gt;=l) p-&gt;ch[<span class="number">0</span>]=build(l,mid<span class="number">-1</span>,p);</div><div class="line">    <span class="keyword">if</span> (mid+<span class="number">1</span>&lt;=r) p-&gt;ch[<span class="number">1</span>]=build(mid+<span class="number">1</span>,r,p);</div><div class="line">    p-&gt;maintain();</div><div class="line">    <span class="keyword">return</span> p;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* &amp;o)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span>;</div><div class="line">    remove(o-&gt;ch[<span class="number">0</span>]);remove(o-&gt;ch[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">delete</span> o;</div><div class="line">    o=<span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> flag;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">InOrder</span><span class="params">(Node* o)</span> </span>&#123;</div><div class="line">    o-&gt;pushdown();</div><div class="line">    o-&gt;maintain();</div><div class="line">    <span class="keyword">if</span> (o-&gt;ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) InOrder(o-&gt;ch[<span class="number">0</span>]);</div><div class="line">    vec.push_back(o-&gt;val);</div><div class="line">    <span class="keyword">if</span> (o-&gt;ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) InOrder(o-&gt;ch[<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</div><div class="line">    vec.clear();</div><div class="line">    InOrder(root);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;vec.size();i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d%c"</span>,vec[i],i==vec.size()<span class="number">-1</span>?<span class="string">'\n'</span>:<span class="string">' '</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 分裂</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(Node* o,<span class="keyword">int</span> k,Node* &amp;left,Node* &amp;right)</span> </span>&#123;</div><div class="line">    splay(o,k);</div><div class="line">    left=o;</div><div class="line">    right=o-&gt;ch[<span class="number">1</span>];</div><div class="line">    <span class="keyword">if</span>(right) right-&gt;par=<span class="literal">NULL</span>;</div><div class="line">    o-&gt;ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    left-&gt;maintain();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 合并</span></div><div class="line"><span class="function">Node* <span class="title">merge</span><span class="params">(Node* left,Node* right)</span> </span>&#123;</div><div class="line">    splay(left, left-&gt;s);</div><div class="line">    left-&gt;ch[<span class="number">1</span>]=right;</div><div class="line">    <span class="keyword">if</span>(right) right-&gt;par=left;</div><div class="line">    left-&gt;maintain();</div><div class="line">    <span class="keyword">return</span> left;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    mid-&gt;add+=val;</div><div class="line">    mid-&gt;val+=val;</div><div class="line">    mid-&gt;pushdown();</div><div class="line">    mid-&gt;maintain();</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    mid-&gt;flip^=<span class="number">1</span>;</div><div class="line">    swap(mid-&gt;ch[<span class="number">1</span>],mid-&gt;ch[<span class="number">0</span>]);</div><div class="line">    mid-&gt;pushdown();mid-&gt;maintain();</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    <span class="keyword">int</span> ret=mid-&gt;sum;</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">revolve</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> t)</span></span>&#123;<span class="comment">//[l,r]区间右移t位，r变为l，l变为l+1...</span></div><div class="line">    <span class="keyword">int</span> len=r-l+<span class="number">1</span>;</div><div class="line">    t%=len;</div><div class="line">    <span class="keyword">if</span>(!t) <span class="keyword">return</span>;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,len,mid,right);</div><div class="line">    Node *le,*ri;</div><div class="line">    split(mid,len-t,le,ri);</div><div class="line">    root=merge(merge(left,merge(ri,le)),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addPoint</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">    Node *mid=build(<span class="number">1</span>,n,<span class="literal">NULL</span>);</div><div class="line">    Node *left,*right;</div><div class="line">    split(root,pos,left,right);</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">delPoint</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,pos,left,o);</div><div class="line">    split(o,n,mid,right);</div><div class="line">    remove(mid);</div><div class="line">    root=merge(left,right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n,q;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q)!=EOF)&#123;</div><div class="line">        remove(root);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">        &#125;</div><div class="line">        root=build(<span class="number">0</span>,n,<span class="literal">NULL</span>);</div><div class="line">        <span class="keyword">char</span> op[<span class="number">15</span>];</div><div class="line">        <span class="keyword">while</span>(q--)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</div><div class="line">            <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'A'</span>)&#123;</div><div class="line">                <span class="keyword">int</span> l,r,v;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;l,&amp;r,&amp;v);</div><div class="line">                update(l,r,v);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'R'</span>)&#123;</div><div class="line">                <span class="keyword">int</span> l,r;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</div><div class="line">                reverse(l,r);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'Q'</span>)&#123;</div><div class="line">                <span class="keyword">int</span> l,r;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(l,r));</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'I'</span>)&#123;</div><div class="line">                <span class="keyword">int</span> pos,k;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;pos,&amp;k);</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)</div><div class="line">                    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">                addPoint(pos,k);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'D'</span>)&#123;</div><div class="line">                <span class="keyword">int</span> pos,k;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;pos,&amp;k);</div><div class="line">                delPoint(pos,k);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                print();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">6 100</div><div class="line">5 1 -1 7 5 0</div><div class="line">*/</div></pre></td></tr></table></figure>
<h4 id="splay修改区间为定值"><a href="#splay修改区间为定值" class="headerlink" title="splay修改区间为定值"></a>splay修改区间为定值</h4>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div></pre></td><td class="code"><pre><div class="line">  <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  ll;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ini -1111</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000010</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> a[maxn];</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    Node* ch[<span class="number">2</span>];</div><div class="line">    Node* par;</div><div class="line">    <span class="keyword">int</span> rank;<span class="comment">// 当前节点在序列中的位置</span></div><div class="line">    <span class="keyword">int</span> s;<span class="comment">// 节点总数</span></div><div class="line">    <span class="keyword">int</span> flip;<span class="comment">// 旋转标记</span></div><div class="line">    <span class="keyword">int</span> setv;<span class="comment">// 增减标记</span></div><div class="line">    <span class="keyword">int</span> val;<span class="comment">// 节点的值</span></div><div class="line">    <span class="keyword">int</span> sum;</div><div class="line">    <span class="keyword">int</span> ma,lv,rv;</div><div class="line">    Node() &#123;</div><div class="line">        par=<span class="literal">NULL</span>;</div><div class="line">        rank=<span class="number">1</span>;</div><div class="line">        s=<span class="number">1</span>;</div><div class="line">        flip=<span class="number">0</span>;</div><div class="line">        setv=ini;</div><div class="line">        sum=<span class="number">0</span>;</div><div class="line">        ma=lv=rv=<span class="number">0</span>;</div><div class="line">        ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (x==rank) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        <span class="keyword">return</span> x&lt;rank? <span class="number">0</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</div><div class="line">        s=<span class="number">1</span>;</div><div class="line">        rank=<span class="number">1</span>;</div><div class="line">        sum=val;</div><div class="line">        <span class="keyword">int</span> m=val;</div><div class="line">        ma=lv=rv=val;</div><div class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">            s+=ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            rank+=ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            sum+=ch[<span class="number">0</span>]-&gt;sum;</div><div class="line">            m=max(m,ch[<span class="number">0</span>]-&gt;rv+m);</div><div class="line">            ma=max(m,ch[<span class="number">0</span>]-&gt;ma);</div><div class="line">            lv=max(ch[<span class="number">0</span>]-&gt;lv,sum);</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">1</span>]==<span class="literal">NULL</span>) rv=max(rv,val+ch[<span class="number">0</span>]-&gt;rv);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">            s+=ch[<span class="number">1</span>]-&gt;s;</div><div class="line">            m=max(m,ch[<span class="number">1</span>]-&gt;lv+m);</div><div class="line">            ma=max(max(ma,m),ch[<span class="number">1</span>]-&gt;ma);</div><div class="line">            lv=max(lv,sum+ch[<span class="number">1</span>]-&gt;lv);</div><div class="line">            rv=max(ch[<span class="number">1</span>]-&gt;rv,ch[<span class="number">1</span>]-&gt;sum+val);</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) rv=max(rv,ch[<span class="number">1</span>]-&gt;sum+val+ch[<span class="number">0</span>]-&gt;rv);</div><div class="line">            sum+=ch[<span class="number">1</span>]-&gt;sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (flip) &#123;</div><div class="line">            flip=<span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">0</span>]-&gt;flip^=<span class="number">1</span>;</div><div class="line">                swap(ch[<span class="number">0</span>]-&gt;ch[<span class="number">0</span>],ch[<span class="number">0</span>]-&gt;ch[<span class="number">1</span>]);</div><div class="line">                swap(ch[<span class="number">0</span>]-&gt;lv,ch[<span class="number">0</span>]-&gt;rv);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">1</span>]-&gt;flip^=<span class="number">1</span>;</div><div class="line">                swap(ch[<span class="number">1</span>]-&gt;ch[<span class="number">0</span>],ch[<span class="number">1</span>]-&gt;ch[<span class="number">1</span>]);</div><div class="line">                swap(ch[<span class="number">1</span>]-&gt;lv,ch[<span class="number">1</span>]-&gt;rv);</div><div class="line">            &#125;</div><div class="line">            swap(lv,rv);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (setv!=ini) &#123;</div><div class="line">            <span class="keyword">if</span> (ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">0</span>]-&gt;val=setv;</div><div class="line">                ch[<span class="number">0</span>]-&gt;setv=setv;</div><div class="line">                ch[<span class="number">0</span>]-&gt;sum=setv*ch[<span class="number">0</span>]-&gt;s;</div><div class="line">                ch[<span class="number">0</span>]-&gt;ma=ch[<span class="number">0</span>]-&gt;lv=ch[<span class="number">0</span>]-&gt;rv=max(setv,ch[<span class="number">0</span>]-&gt;sum);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) &#123;</div><div class="line">                ch[<span class="number">1</span>]-&gt;val=setv;</div><div class="line">                ch[<span class="number">1</span>]-&gt;setv=setv;</div><div class="line">                ch[<span class="number">1</span>]-&gt;sum=setv*ch[<span class="number">1</span>]-&gt;s;</div><div class="line">                ch[<span class="number">1</span>]-&gt;ma=ch[<span class="number">1</span>]-&gt;lv=ch[<span class="number">1</span>]-&gt;rv=max(setv,ch[<span class="number">1</span>]-&gt;sum);</div><div class="line">            &#125;</div><div class="line">            setv=ini;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Node* root=<span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">    Node* k = o-&gt;ch[d^<span class="number">1</span>];</div><div class="line">    Node* par = o-&gt;par;</div><div class="line">    o-&gt;ch[d^<span class="number">1</span>] = k-&gt;ch[d];</div><div class="line">    <span class="keyword">if</span>(k-&gt;ch[d]) k-&gt;ch[d]-&gt;par=o;</div><div class="line">    k-&gt;ch[d] = o;</div><div class="line">    o-&gt;par=k;</div><div class="line">    k-&gt;par=par;</div><div class="line">    o-&gt;maintain();</div><div class="line">    k-&gt;maintain();</div><div class="line">    o=k;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="comment">//correct</span></div><div class="line">    o-&gt;pushdown();</div><div class="line">    o-&gt;maintain();</div><div class="line">    <span class="keyword">int</span> d= o-&gt;cmp(k);</div><div class="line">    <span class="keyword">if</span> (d==<span class="number">1</span>) k -= o-&gt;rank;</div><div class="line">    <span class="keyword">if</span> (d!=<span class="number">-1</span>) &#123;</div><div class="line">        Node* p = o-&gt;ch[d];</div><div class="line">        p-&gt;pushdown();</div><div class="line">        p-&gt;maintain();</div><div class="line">        <span class="keyword">int</span> d2 = p-&gt;cmp(k);</div><div class="line">        <span class="keyword">int</span> k2 = (d2==<span class="number">0</span> ? k : k-p-&gt;rank);</div><div class="line">        <span class="keyword">if</span> (d2!=<span class="number">-1</span>) &#123;</div><div class="line">            splay(p-&gt;ch[d2],k2);</div><div class="line">            <span class="keyword">if</span> (d==d2) rotate(o,d^<span class="number">1</span>);</div><div class="line">            <span class="keyword">else</span> rotate(o-&gt;ch[d], d);</div><div class="line">        &#125;</div><div class="line">        rotate(o,d^<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Node* id[maxn];</span></div><div class="line"><span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,Node *fa)</span> </span>&#123;</div><div class="line">    Node* p;</div><div class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    p=<span class="keyword">new</span> Node();</div><div class="line">    p-&gt;val=a[mid];</div><div class="line"><span class="comment">//    id[a[mid]]=p;</span></div><div class="line">    p-&gt;s=r-l+<span class="number">1</span>;</div><div class="line">    p-&gt;rank=mid-l+<span class="number">1</span>;</div><div class="line">    p-&gt;flip=<span class="number">0</span>;</div><div class="line">    p-&gt;setv=ini;</div><div class="line">    p-&gt;par=fa;</div><div class="line">    p-&gt;ch[<span class="number">0</span>]=p-&gt;ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span> (mid<span class="number">-1</span>&gt;=l) p-&gt;ch[<span class="number">0</span>]=build(l,mid<span class="number">-1</span>,p);</div><div class="line">    <span class="keyword">if</span> (mid+<span class="number">1</span>&lt;=r) p-&gt;ch[<span class="number">1</span>]=build(mid+<span class="number">1</span>,r,p);</div><div class="line">    p-&gt;maintain();</div><div class="line">    <span class="keyword">return</span> p;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* &amp;o)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span>;</div><div class="line">    remove(o-&gt;ch[<span class="number">0</span>]);</div><div class="line">    remove(o-&gt;ch[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">delete</span> o;</div><div class="line">    o=<span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 分裂</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(Node* o,<span class="keyword">int</span> k,Node* &amp;left,Node* &amp;right)</span> </span>&#123;</div><div class="line">    splay(o,k);</div><div class="line">    left=o;</div><div class="line">    right=o-&gt;ch[<span class="number">1</span>];</div><div class="line">    <span class="keyword">if</span>(right) right-&gt;par=<span class="literal">NULL</span>;</div><div class="line">    o-&gt;ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">    left-&gt;maintain();</div><div class="line"><span class="comment">//    printf("~~%d\n",left-&gt;ch[0]-&gt;rv);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 合并</span></div><div class="line"><span class="function">Node* <span class="title">merge</span><span class="params">(Node* left,Node* right)</span> </span>&#123;</div><div class="line">    splay(left, left-&gt;s);</div><div class="line">    left-&gt;ch[<span class="number">1</span>]=right;</div><div class="line">    <span class="keyword">if</span>(right) right-&gt;par=left;</div><div class="line">    left-&gt;maintain();</div><div class="line">    <span class="keyword">return</span> left;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> setv)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    mid-&gt;setv=setv;</div><div class="line">    mid-&gt;val=setv;</div><div class="line">    mid-&gt;pushdown();</div><div class="line">    mid-&gt;maintain();</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    mid-&gt;flip^=<span class="number">1</span>;</div><div class="line">    swap(mid-&gt;ch[<span class="number">1</span>],mid-&gt;ch[<span class="number">0</span>]);</div><div class="line">    mid-&gt;pushdown();</div><div class="line">    mid-&gt;maintain();</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,l,left,o);</div><div class="line">    split(o,r-l+<span class="number">1</span>,mid,right);</div><div class="line">    <span class="keyword">int</span> ret=mid-&gt;sum;</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addPoint</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    Node *mid=build(<span class="number">1</span>,n,<span class="literal">NULL</span>);</div><div class="line">    Node *left,*right;</div><div class="line">    split(root,pos,left,right);</div><div class="line">    root=merge(merge(left,mid),right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">delPoint</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    Node *left,*mid,*right,*o;</div><div class="line">    split(root,pos,left,o);</div><div class="line">    split(o,n,mid,right);</div><div class="line">    remove(mid);</div><div class="line">    root=merge(left,right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</div><div class="line"><span class="comment">//    freopen("data.txt","r",stdin);</span></div><div class="line"><span class="comment">//    freopen("ans.txt","w",stdout);</span></div><div class="line">    <span class="keyword">int</span> n,q;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q)!=EOF) &#123;</div><div class="line">        remove(root);</div><div class="line">        a[<span class="number">0</span>]=<span class="number">-10000</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">        &#125;</div><div class="line">        root=build(<span class="number">0</span>,n,<span class="literal">NULL</span>);</div><div class="line">        <span class="keyword">char</span> op[<span class="number">15</span>];</div><div class="line">        <span class="keyword">while</span>(q--) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</div><div class="line">            <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'M'</span>&amp;&amp;op[<span class="number">2</span>]==<span class="string">'K'</span>) &#123;</div><div class="line">                <span class="keyword">int</span> l,r,v;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;l,&amp;r,&amp;v);</div><div class="line">                <span class="keyword">if</span>(r!=<span class="number">0</span>) update(l,l+r<span class="number">-1</span>,v);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'R'</span>) &#123;</div><div class="line">                <span class="keyword">int</span> l,r;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</div><div class="line">                <span class="keyword">if</span>(r!=<span class="number">0</span>) reverse(l,l+r<span class="number">-1</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'G'</span>) &#123;</div><div class="line">                <span class="keyword">int</span> l,r;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</div><div class="line">                <span class="keyword">if</span>(r==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">                <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(l,l+r<span class="number">-1</span>));</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'I'</span>) &#123;</div><div class="line">                <span class="keyword">int</span> pos,k;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;pos,&amp;k);</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=k; i++)</div><div class="line">                    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">                addPoint(pos+<span class="number">1</span>,k);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'D'</span>) &#123;</div><div class="line">                <span class="keyword">int</span> pos,k;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;pos,&amp;k);</div><div class="line">                delPoint(pos,k);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,root-&gt;ma==<span class="number">-10000</span>?<span class="number">0</span>:root-&gt;ma);</div><div class="line">            &#125;</div><div class="line"><span class="comment">//            print(root);</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">20 50</div><div class="line">8 9 4 8 9 -3 8 1 -6 4 8 5 3 0 0 9 -9 9 -5 9</div><div class="line">GET-SUM 1 13</div><div class="line">MAX-SUM</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="Treap"><a href="#Treap" class="headerlink" title="Treap"></a>Treap</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/* </span></div><div class="line">  该代码默认不去重</div><div class="line">*/</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cassert&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    Node *ch[<span class="number">2</span>];</div><div class="line">    <span class="keyword">int</span> r,v,s;<span class="comment">//s表示节点数</span></div><div class="line"></div><div class="line">    Node(<span class="keyword">int</span> v):v(v) &#123;</div><div class="line">        ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</div><div class="line">        r=rand();<span class="comment">//在cstdlib头声明</span></div><div class="line">        s=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp;rhs) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> r &lt; rhs.r;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(x==v)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        <span class="keyword">return</span> x&lt;v?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</div><div class="line">        s=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) s+=ch[<span class="number">0</span>]-&gt;s;</div><div class="line">        <span class="keyword">if</span>(ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) s+=ch[<span class="number">1</span>]-&gt;s;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">    Node *k=o-&gt;ch[d^<span class="number">1</span>];</div><div class="line">    o-&gt;ch[d^<span class="number">1</span>]=k-&gt;ch[d];</div><div class="line">    k-&gt;ch[d]=o;</div><div class="line">    o-&gt;maintain();</div><div class="line">    k-&gt;maintain();</div><div class="line">    o=k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> x)</span> </span>&#123; <span class="comment">//o子树中事先不存在x</span></div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) o=<span class="keyword">new</span> Node(x);</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//如这里改成int d=o-&gt;cmp(x);</span></div><div class="line">        <span class="comment">//就不可以插入相同的值，因为d可能为-1</span></div><div class="line">        <span class="comment">//if(x==o-&gt;v) return;  //如果需要去重</span></div><div class="line">        <span class="keyword">int</span> d=x&lt;(o-&gt;v)?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">        insert(o-&gt;ch[d],x);</div><div class="line">        <span class="keyword">if</span>(o-&gt;ch[d]-&gt;r &gt; o-&gt;r)</div><div class="line">            rotate(o,d^<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    o-&gt;maintain();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(Node* &amp;o,<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span> ;<span class="comment">//空时返回</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> d=o-&gt;cmp(x);</div><div class="line">    <span class="keyword">if</span>(d==<span class="number">-1</span>) &#123;</div><div class="line">        Node *u=o;</div><div class="line">        <span class="keyword">if</span>(o-&gt;ch[<span class="number">0</span>] &amp;&amp; o-&gt;ch[<span class="number">1</span>]) &#123;</div><div class="line">            <span class="keyword">int</span> d2=(o-&gt;ch[<span class="number">0</span>]-&gt;r &gt; o-&gt;ch[<span class="number">1</span>]-&gt;r)?<span class="number">1</span>:<span class="number">0</span>;</div><div class="line">            rotate(o,d2);</div><div class="line">            erase(o-&gt;ch[d2],x);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(o-&gt;ch[<span class="number">0</span>]==<span class="literal">NULL</span>) o=o-&gt;ch[<span class="number">1</span>];</div><div class="line">            <span class="keyword">else</span> o=o-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">delete</span> u;<span class="comment">//这个要放里面</span></div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> erase(o-&gt;ch[d],x);</div><div class="line">    <span class="keyword">if</span>(o) o-&gt;maintain();<span class="comment">//之前o存在,但是删除节点后o可能就是空NULL了,所以需要先判断o是否为空</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//返回关键字从小到大排序时的第k个值</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(Node* o,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span> || k&lt;=<span class="number">0</span> || k&gt;o-&gt;s) <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//保证输入合法</span></div><div class="line">    <span class="keyword">int</span> s=(o-&gt;ch[<span class="number">0</span>]==<span class="literal">NULL</span>)?<span class="number">0</span>:o-&gt;ch[<span class="number">0</span>]-&gt;s;</div><div class="line">    <span class="keyword">if</span>(k==s+<span class="number">1</span>) <span class="keyword">return</span> o-&gt;v;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(k&lt;=s) <span class="keyword">return</span> kth(o-&gt;ch[<span class="number">0</span>],k);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> kth(o-&gt;ch[<span class="number">1</span>],k-s<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//返回值x在树中的排名,就算x不在o树中也能返回排名</span></div><div class="line"><span class="comment">//返回值范围在[1,o-&gt;s+1]范围内</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rank</span><span class="params">(Node* o,<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//未找到x;</span></div><div class="line">    <span class="keyword">int</span> num= o-&gt;ch[<span class="number">0</span>]==<span class="literal">NULL</span> ? <span class="number">0</span>:o-&gt;ch[<span class="number">0</span>]-&gt;s;</div><div class="line">    <span class="keyword">if</span>(x &lt;= o-&gt;v) <span class="keyword">return</span> rank(o-&gt;ch[<span class="number">0</span>],x);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> rank(o-&gt;ch[<span class="number">1</span>],x)+num+<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(Node *o,<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(o!=<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">int</span> d=o-&gt;cmp(x);</div><div class="line">        <span class="keyword">if</span>(d==<span class="number">-1</span>)<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">//存在</span></div><div class="line">        o=o-&gt;ch[d];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;              <span class="comment">//不存在</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get_Max</span><span class="params">(Node *o)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(o-&gt;ch[<span class="number">1</span>]!=<span class="literal">NULL</span>) o=o-&gt;ch[<span class="number">1</span>];</div><div class="line">    <span class="keyword">return</span> o-&gt;v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get_Min</span><span class="params">(Node *o)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(o-&gt;ch[<span class="number">0</span>]!=<span class="literal">NULL</span>) o=o-&gt;ch[<span class="number">0</span>];</div><div class="line">    <span class="keyword">return</span> o-&gt;v;</div><div class="line">&#125;</div><div class="line"><span class="comment">//不存在则返回y</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_pre</span><span class="params">(Node *o,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(k&gt;o-&gt;v)<span class="comment">//加个等号就是小于等于</span></div><div class="line">        <span class="keyword">return</span> get_pre(o-&gt;ch[<span class="number">1</span>],o-&gt;v,k);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> get_pre(o-&gt;ch[<span class="number">0</span>],y,k);</div><div class="line">&#125;</div><div class="line"><span class="comment">//不存在则返回y</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_next</span><span class="params">(Node *o,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(k&lt;o-&gt;v)<span class="comment">//加个等号就是小于等于</span></div><div class="line">        <span class="keyword">return</span> get_next(o-&gt;ch[<span class="number">0</span>],o-&gt;v,k);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> get_next(o-&gt;ch[<span class="number">1</span>],y,k);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Node *o)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span>;</div><div class="line">    init(o-&gt;ch[<span class="number">0</span>]);</div><div class="line">    init(o-&gt;ch[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">delete</span> o;</div><div class="line">    o=<span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">inorder</span><span class="params">(Node *o)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(o==<span class="literal">NULL</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        inorder(o-&gt;ch[<span class="number">0</span>]);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">" %d"</span>,o-&gt;v);</div><div class="line">        inorder(o-&gt;ch[<span class="number">1</span>]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Node *root;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)==<span class="number">1</span> &amp;&amp; n) &#123;</div><div class="line">        init(root);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</div><div class="line">            <span class="keyword">if</span>(root==<span class="literal">NULL</span>) root=<span class="keyword">new</span> Node(x);</div><div class="line">            <span class="keyword">else</span> insert(root,x);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> v;</div><div class="line">        <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;v)==<span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"rank : %d\n"</span>,rank(root,v));</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Kth : %d\n"</span>,kth(root,v));</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"pre : %d\n"</span>,get_pre(root,<span class="number">-111</span>,v));</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"next : %d\n"</span>,get_next(root,<span class="number">-111</span>,v));</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"order :"</span>);inorder(root);<span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"max : %d\n"</span>,Get_Max(root));</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"min : %d\n"</span>,Get_Min(root));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="划分树——不带修改的区间第k小"><a href="#划分树——不带修改的区间第k小" class="headerlink" title="划分树——不带修改的区间第k小"></a>划分树——不带修改的区间第k小</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100005</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> l,r;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mid</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125; tree[N&lt;&lt;<span class="number">2</span>];</div><div class="line"></div><div class="line"><span class="keyword">int</span> sorted[N];</div><div class="line"><span class="keyword">int</span> val[<span class="number">20</span>][N],toLeft[<span class="number">20</span>][N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> rt,<span class="keyword">int</span> deep)</span> </span>&#123;</div><div class="line">    tree[rt].l = l;</div><div class="line">    tree[rt].r  = r;</div><div class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> m = tree[rt].mid();</div><div class="line">    <span class="keyword">int</span> midval = sorted[m];</div><div class="line">    <span class="keyword">int</span> leftsame = m - l + <span class="number">1</span>;<span class="comment">//表示在左子树上有多少和midval相等的数</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l ; i &lt;= r ; i ++) &#123;</div><div class="line">        <span class="keyword">if</span>(val[deep][i] &lt; midval)</div><div class="line">            --leftsame;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> lpos = l,rpos = m + <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l ; i &lt;= r ;  i++) &#123;</div><div class="line">        <span class="keyword">if</span>(i == l) toLeft[deep][i] = <span class="number">0</span>;<span class="comment">//toLeft[][i]表示[tree[rt].l,i-1]有多少数在左部</span></div><div class="line">        <span class="keyword">else</span> toLeft[deep][i] = toLeft[deep][i<span class="number">-1</span>];<span class="comment">//这里相当于对toLeft[][]初始化</span></div><div class="line">        <span class="keyword">if</span>(val[deep][i] &lt; midval) &#123;</div><div class="line">            ++toLeft[deep][i];</div><div class="line">            val[deep+<span class="number">1</span>][lpos++] = val[deep][i];</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(val[deep][i] &gt; midval) &#123;</div><div class="line">            val[deep+<span class="number">1</span>][rpos++] = val[deep][i];</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//判断和midval相等的数是放在左部还是右部</span></div><div class="line">            <span class="keyword">if</span>(leftsame &gt;= <span class="number">0</span>) &#123;</div><div class="line">                --leftsame;</div><div class="line">                ++toLeft[deep][i];</div><div class="line">                val[deep+<span class="number">1</span>][lpos++] = val[deep][i];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                val[deep+<span class="number">1</span>][rpos++] = val[deep][i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    build(l,m,rt&lt;&lt;<span class="number">1</span>,deep+<span class="number">1</span>);</div><div class="line">    build(m+<span class="number">1</span>,r,rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,deep+<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k,<span class="keyword">int</span> rt,<span class="keyword">int</span> deep)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> val[deep][l];</div><div class="line">    <span class="comment">//下面就是要确认新的查找区间</span></div><div class="line">    <span class="keyword">int</span> s;<span class="comment">//表示[l,r]里在左边的数的个数</span></div><div class="line">    <span class="keyword">int</span> ss;<span class="comment">//表示[tree[rt].l,l-1]里在左边的数的个数</span></div><div class="line">    <span class="keyword">if</span>(l == tree[rt].l) &#123;</div><div class="line">        s = toLeft[deep][r];</div><div class="line">        ss = <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        ss = toLeft[deep][l<span class="number">-1</span>];</div><div class="line">        s = toLeft[deep][r] - ss;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//注意这里的在左边的数都是和sorted[m]相比的，由此可以得到如果s&gt;=k就去左子树找，相反则去右子树</span></div><div class="line">    <span class="keyword">if</span>(s &gt;= k) &#123;</div><div class="line">        <span class="comment">/*进入左子树，该条线段的左边有ss个数及从是从上面[tree[rt].l,l-1]该进入左子树的数继承而来</span></div><div class="line">        *接着还应该有toLeft[deep][r] - toLeft[deep][l-1]个数即s个数</div><div class="line">        *所以可以确定新的查找区间应该是[tree[rt].l+ss,newl+s - 1]</div><div class="line">        */</div><div class="line">        <span class="keyword">int</span> newl = tree[rt].l + ss;</div><div class="line">        <span class="keyword">int</span> newr = newl + s - <span class="number">1</span>;<span class="comment">//这里减1是为了处理边界问题</span></div><div class="line">        <span class="keyword">return</span> query(newl,newr,k,rt&lt;&lt;<span class="number">1</span>,deep+<span class="number">1</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *进入右子树，该条线段的左边应该是上条线段[tree[rt].l,l-1]应该进入右子树的数，即bb = l - tree[rt].l - ss个数</div><div class="line">        *接着还应该有上条线段[l,r]应该进入右子树的数，即b = r - l + 1 - s个数</div><div class="line">        *所以可以确定新的查询区间应该是[mid + 1 + bb,mid + 1 + bb + b - 1]，这里的-1同一是为了处理边界问题</div><div class="line">        */</div><div class="line">        <span class="keyword">int</span> m = tree[rt].mid();</div><div class="line">        <span class="keyword">int</span> b = r - l + <span class="number">1</span> - s;<span class="comment">//表示[l,r]在右边的数的个数</span></div><div class="line">        <span class="keyword">int</span> bb = (l - <span class="number">1</span>) - tree[rt].l + <span class="number">1</span> - ss;<span class="comment">//表示[tree[rt].l,l-1]在右边的数的个数</span></div><div class="line">        <span class="keyword">int</span> newl = m + <span class="number">1</span> + bb;</div><div class="line">        <span class="keyword">int</span> newr = m + b + bb;<span class="comment">//m + r - l + 1 - toLeft[deep][r] + ss - l - tree[rt].l - ss = m+r-</span></div><div class="line">        <span class="keyword">return</span> query(newl,newr,k-s,rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,deep+<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Rint</span><span class="params">()</span> </span>&#123; <span class="comment">//这段是整型数的输入外挂，可以忽略不用看</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> dig[<span class="number">256</span>];</div><div class="line">        X() &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="string">'0'</span>; i &lt;= <span class="string">'9'</span>; ++i) dig[i] = <span class="number">1</span>;</div><div class="line">            dig[<span class="string">'-'</span>] = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">static</span> 	X fuck;</div><div class="line">    <span class="keyword">int</span> s = <span class="number">1</span>, v = <span class="number">0</span>, c;</div><div class="line">    <span class="keyword">for</span> (; !fuck.dig[c = getchar()];);</div><div class="line">    <span class="keyword">if</span> (c == <span class="string">'-'</span>) s = <span class="number">0</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fuck.dig[c]) v = c ^ <span class="number">48</span>;</div><div class="line">    <span class="keyword">for</span> (; fuck.dig[c = getchar()]; v = v * <span class="number">10</span> + (c ^ <span class="number">48</span>));</div><div class="line">    <span class="keyword">return</span> s ? v : -v;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n,m;</div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ;  i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;val[<span class="number">0</span>][i]);</div><div class="line">            sorted[i] = val[<span class="number">0</span>][i];</div><div class="line">        &#125;</div><div class="line">        sort(sorted+<span class="number">1</span>,sorted+n+<span class="number">1</span>);</div><div class="line">        build(<span class="number">1</span>,n,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">while</span>(m--) &#123;</div><div class="line">            <span class="keyword">int</span> a,b,c;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;a,&amp;b,&amp;c);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(a,b,c,<span class="number">1</span>,<span class="number">0</span>));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="单点修改区间第K大——分块"><a href="#单点修改区间第K大——分块" class="headerlink" title="单点修改区间第K大——分块"></a>单点修改区间第K大——分块</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 100002</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,ub=<span class="number">0</span>,lb=<span class="number">0x7fffffff</span>,kuai;</div><div class="line"><span class="comment">//ub上界，lb下界，kuai块的大小 </span></div><div class="line"><span class="keyword">int</span> num[MAX],divd[MAX];</div><div class="line"><span class="comment">//num原序列，divd分块数组 </span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">b_s</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> a)</span></span>&#123;<span class="comment">//二分查找 </span></div><div class="line">	<span class="keyword">while</span>(l!=r)&#123;</div><div class="line">		<span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>(divd[m]&gt;=a)r=m;</div><div class="line">		<span class="keyword">else</span> l=m+<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(divd[l]&gt;=a)--l;</div><div class="line">	<span class="keyword">return</span> l;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> a)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> l=((pos<span class="number">-1</span>)/kuai)*kuai+<span class="number">1</span>;</div><div class="line">	<span class="keyword">int</span> r=min(n,l+kuai<span class="number">-1</span>);</div><div class="line">	<span class="keyword">int</span> ks=b_s(l,r,num[pos])+<span class="number">1</span>;</div><div class="line">	<span class="comment">//二分查找位置 </span></div><div class="line">	divd[ks]=a;</div><div class="line">	<span class="keyword">while</span>(divd[ks]&lt;divd[ks<span class="number">-1</span>]&amp;&amp;ks<span class="number">-1</span>&gt;=l)&#123;swap(divd[ks],divd[ks<span class="number">-1</span>]);--ks;&#125;</div><div class="line">	<span class="keyword">while</span>(divd[ks]&gt;divd[ks+<span class="number">1</span>]&amp;&amp;ks+<span class="number">1</span>&lt;=r)&#123;swap(divd[ks],divd[ks+<span class="number">1</span>]);++ks;&#125;</div><div class="line">	<span class="comment">//移动到拍好序的位置 </span></div><div class="line">	num[pos]=a;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> lk=((l<span class="number">-1</span>)/kuai)+<span class="number">1</span>,rk=((r<span class="number">-1</span>)/kuai)<span class="number">-1</span>;</div><div class="line">	<span class="comment">//确定查询的块 </span></div><div class="line">	<span class="keyword">int</span> d=lb,u=ub;</div><div class="line">	<span class="keyword">while</span>(d!=u)&#123;<span class="comment">//二分答案 </span></div><div class="line">		<span class="keyword">int</span> m=(d+u)&gt;&gt;<span class="number">1</span>;</div><div class="line">		<span class="keyword">int</span> kth=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(lk&lt;=rk)&#123; <span class="comment">//在两边直接查找，块内二分查找 </span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=lk*kuai;i++)<span class="keyword">if</span>(num[i]&lt;m)++kth;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=lk;i&lt;=rk;i++)kth+=b_s(i*kuai+<span class="number">1</span>,i*kuai+kuai,m)-i*kuai;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=rk*kuai+kuai+<span class="number">1</span>;i&lt;=r;i++)<span class="keyword">if</span>(num[i]&lt;m)++kth;</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=r;i++)<span class="keyword">if</span>(num[i]&lt;m)++kth;<span class="comment">//在同一块内 </span></div><div class="line">		<span class="keyword">if</span>(kth&gt;=k)u=m;</div><div class="line">		<span class="keyword">else</span> d=m+<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> d<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//freopen("kth.in","r",stdin);</span></div><div class="line">	<span class="keyword">int</span> m;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;num[i]);</div><div class="line">		ub=max(ub,num[i]+<span class="number">1</span>);</div><div class="line">		lb=min(lb,num[i]<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//输入，确定上下界 </span></div><div class="line">	<span class="built_in">memcpy</span>(divd,num,<span class="keyword">sizeof</span> num);</div><div class="line">	kuai=<span class="built_in">sqrt</span>(n+<span class="number">0.5</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=kuai;i++)sort(divd+i*kuai+<span class="number">1</span>,divd+min(n,(i+<span class="number">1</span>)*kuai)+<span class="number">1</span>);</div><div class="line">	<span class="comment">//分块并排序 </span></div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="keyword">int</span> r,l,k;</div><div class="line">		<span class="keyword">char</span> q;</div><div class="line">		<span class="keyword">do</span>&#123;<span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;q);&#125;<span class="keyword">while</span>(q!=<span class="string">'C'</span>&amp;&amp;q!=<span class="string">'Q'</span>);</div><div class="line">		<span class="keyword">if</span>(q==<span class="string">'C'</span>)&#123;<span class="comment">//修改 </span></div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;k);</div><div class="line">			change(l,k);</div><div class="line">			<span class="keyword">if</span>(k+<span class="number">1</span>&gt;ub)ub=k+<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(k<span class="number">-1</span>&lt;lb)lb=k<span class="number">-1</span>;</div><div class="line">			<span class="comment">//更新上下界 </span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span>&#123;<span class="comment">//查询 </span></div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;l,&amp;r,&amp;k);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(l,r,k));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//printf("\nRuntime: %d ms",clock());</span></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="二维树状数组"><a href="#二维树状数组" class="headerlink" title="二维树状数组"></a>二维树状数组</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> c[MAXN][MAXM];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> x&amp;(-x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i))</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = y; j &gt; <span class="number">0</span>; j -= lowbit(j))</div><div class="line">            ret += c[i][j];</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = x; i &lt;= n; i += lowbit(i))</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = y; j &lt;= m; j += lowbit(j))</div><div class="line">            c[i][j] += val;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="二维RMQ"><a href="#二维RMQ" class="headerlink" title="二维RMQ"></a>二维RMQ</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;val[i][j]);</div><div class="line">            dp[i][j][<span class="number">0</span>][<span class="number">0</span>] = val[i][j];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; j) &lt;= m; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; j == <span class="number">0</span>) <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row + (<span class="number">1</span> &lt;&lt; i) - <span class="number">1</span> &lt;= n; row++)</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> col = <span class="number">1</span>; col + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= m; col++) &#123;</div><div class="line">                    <span class="comment">//当x或y等于0的时候，就相当于一维的RMQ了</span></div><div class="line">                    <span class="keyword">if</span> (i == <span class="number">0</span>) dp[row][col][i][j] = max(dp[row][col][i][j - <span class="number">1</span>], dp[row][col + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][i][j - <span class="number">1</span>]);</div><div class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span>) dp[row][col][i][j] = max(dp[row][col][i - <span class="number">1</span>][j], dp[row + (<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>))][col][i - <span class="number">1</span>][j]);</div><div class="line">                    <span class="keyword">else</span> dp[row][col][i][j] = max(dp[row][col][i][j - <span class="number">1</span>], dp[row][col + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][i][j - <span class="number">1</span>]);</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> kx = <span class="number">0</span>, ky = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (x1 + (<span class="number">1</span> &lt;&lt; (<span class="number">1</span> + kx)) - <span class="number">1</span> &lt;= x2) kx++;</div><div class="line">    <span class="keyword">while</span> (y1 + (<span class="number">1</span> &lt;&lt; (<span class="number">1</span> + ky)) - <span class="number">1</span> &lt;= y2) ky++;</div><div class="line">    <span class="keyword">int</span> m1 = dp[x1][y1][kx][ky];</div><div class="line">    <span class="keyword">int</span> m2 = dp[x2 - (<span class="number">1</span> &lt;&lt; kx) + <span class="number">1</span>][y1][kx][ky];</div><div class="line">    <span class="keyword">int</span> m3 = dp[x1][y2 - (<span class="number">1</span> &lt;&lt; ky) + <span class="number">1</span>][kx][ky];</div><div class="line">    <span class="keyword">int</span> m4 = dp[x2 - (<span class="number">1</span> &lt;&lt; kx) + <span class="number">1</span>][y2 - (<span class="number">1</span> &lt;&lt; ky) + <span class="number">1</span>][kx][ky];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> max(max(m1, m2), max(m3, m4));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line">给两个串S和P，问P在S中不重复匹配多少次</div><div class="line">*/</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">100010</span>;</div><div class="line"><span class="keyword">char</span> s[maxn];</div><div class="line"><span class="keyword">int</span> sa[maxn],Rank[maxn],height[maxn];</div><div class="line"><span class="keyword">int</span> t1[maxn],t2[maxn],c[maxn],n;</div><div class="line"><span class="keyword">int</span> dmin[maxn][<span class="number">20</span>];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> *y,<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a1=y[a];</div><div class="line">    <span class="keyword">int</span> b1=y[b];</div><div class="line">    <span class="keyword">int</span> a2=a+k&gt;=n ? <span class="number">-1</span>:y[a+k];</div><div class="line">    <span class="keyword">int</span> b2=b+k&gt;=n ? <span class="number">-1</span>:y[b+k];</div><div class="line">    <span class="keyword">return</span> a1==b1 &amp;&amp; a2==b2;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_sa</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> *x = t1, *y = t2;</div><div class="line">    <span class="comment">//基数排序</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) c[i] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[x[i] = s[i]]++;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) c[i] += c[i<span class="number">-1</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) sa[--c[x[i]]] = i;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; k &lt;&lt;= <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> p = <span class="number">0</span>;</div><div class="line">        <span class="comment">//直接利用sa数组排序第二关键字</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n-k; i &lt; n; i++) y[p++] = i;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="keyword">if</span>(sa[i] &gt;= k) y[p++] = sa[i] - k;</div><div class="line">        <span class="comment">//基数排序第一关键字</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) c[i] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[x[y[i]]]++;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) c[i] += c[i<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>; i&gt;= <span class="number">0</span>; i--) sa[--c[x[y[i]]]] = y[i];</div><div class="line">        <span class="comment">//根据sa和y数组计算新的x数组</span></div><div class="line">        swap(x, y);</div><div class="line">        p = <span class="number">1</span>;</div><div class="line">        x[sa[<span class="number">0</span>]] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)</div><div class="line">            x[sa[i]]=cmp(y,sa[i],sa[i<span class="number">-1</span>],k) ? p<span class="number">-1</span>:p++;</div><div class="line">        <span class="keyword">if</span>(p &gt;= n) <span class="keyword">break</span>;</div><div class="line">        m = p;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_height</span><span class="params">()</span> </span>&#123; <span class="comment">//n不能等于1,否则出BUG</span></div><div class="line">    <span class="keyword">int</span> i,j,k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++) Rank[sa[i]]=i;</div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(k) k--;</div><div class="line">        <span class="keyword">if</span>(!Rank[i]) <span class="keyword">continue</span>;</div><div class="line">        j=sa[Rank[i]<span class="number">-1</span>];</div><div class="line">        <span class="keyword">while</span>(s[i+k]==s[j+k])k++;</div><div class="line">        height[Rank[i]]=k;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">initMin</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) dmin[i][<span class="number">0</span>] = height[i];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j) &lt;= n; j++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i + (<span class="number">1</span>&lt;&lt;j) - <span class="number">1</span> &lt; n; i++)</div><div class="line">            dmin[i][j] = min(dmin[i][j<span class="number">-1</span>], dmin[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">RMQ</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span> </span>&#123; <span class="comment">//取得范围最小值</span></div><div class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;(k+<span class="number">1</span>))&lt;=R-L+<span class="number">1</span>)k++;</div><div class="line">    <span class="keyword">return</span> min(dmin[L][k], dmin[R-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123; <span class="comment">//求后缀i和j的LCP最长公共前缀</span></div><div class="line">    <span class="keyword">int</span> L=Rank[i],R=Rank[j];</div><div class="line">    <span class="keyword">if</span>(L&gt;R) swap(L,R);</div><div class="line">    <span class="keyword">return</span> RMQ(L+<span class="number">1</span>,R);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp_suffix</span><span class="params">(<span class="keyword">char</span> *P,<span class="keyword">int</span> p,<span class="keyword">int</span> c,<span class="keyword">int</span> &amp;k)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; P[c+i] == s[sa[p]+c+i]; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(P[c+i] == <span class="string">'\0'</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        k++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(P[c+i] == <span class="string">'\0'</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> P[c+i] - s[sa[p]+c+i];</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> P[maxn];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Find</span><span class="params">()</span> </span>&#123;</div><div class="line">    vec.clear();</div><div class="line">    <span class="keyword">int</span> m=<span class="built_in">strlen</span>(P);</div><div class="line">    <span class="keyword">int</span> L=<span class="number">0</span>,R=n<span class="number">-1</span>,k,pos=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">if</span>(cmp_suffix(P,L,<span class="number">0</span>,k)&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="keyword">if</span>(cmp_suffix(P,R,<span class="number">0</span>,k)&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(L&lt;R) &#123;</div><div class="line">        <span class="keyword">int</span> M=(L+R)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span>(pos!=<span class="number">-1</span>&amp;&amp;LCP(sa[pos],sa[M])&lt;k) &#123;</div><div class="line">            <span class="keyword">int</span> r=LCP(sa[pos],sa[M]),t;</div><div class="line">            <span class="keyword">int</span> ans=cmp_suffix(P,M,r,t);</div><div class="line">            <span class="keyword">if</span>(ans&gt;<span class="number">0</span>) L=M+<span class="number">1</span>;</div><div class="line">            <span class="keyword">else</span> R=M;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> ans=cmp_suffix(P,M,k,k);</div><div class="line">            <span class="keyword">if</span>(ans&gt;<span class="number">0</span>) L=M+<span class="number">1</span>;</div><div class="line">            <span class="keyword">else</span> R=M;</div><div class="line">            pos=M;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(k&lt;m) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    vec.push_back(sa[L]);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L+<span class="number">1</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(height[i]&gt;=m) &#123;</div><div class="line">            vec.push_back(sa[i]);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    n=<span class="built_in">strlen</span>(s);</div><div class="line">    build_sa(<span class="number">200</span>);</div><div class="line">    build_height();</div><div class="line">    initMin();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s)!=EOF) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s,<span class="string">"#"</span>)==<span class="number">0</span>) <span class="keyword">break</span>;</div><div class="line">        init();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,P);</div><div class="line">        <span class="keyword">int</span> m=<span class="built_in">strlen</span>(P);</div><div class="line">        Find();</div><div class="line">        <span class="keyword">if</span>(vec.size()==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            sort(vec.begin(),vec.end());</div><div class="line">            <span class="keyword">int</span> ans=<span class="number">1</span>,pos=vec[<span class="number">0</span>];</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;vec.size(); i++) &#123;</div><div class="line">                <span class="keyword">if</span>(vec[i]-pos&gt;=m) &#123;</div><div class="line">                    ans++;</div><div class="line">                    pos=vec[i];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//数组版</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">10005</span>;</div><div class="line"><span class="keyword">int</span> sa[N],r[N],wa[N], wb[N], ws[N], wv[N];</div><div class="line"><span class="keyword">int</span> rank[N], height[N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> r[], <span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> l)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> r[a] == r[b] &amp;&amp; r[a+l] == r[b+l];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">da</span><span class="params">(<span class="keyword">int</span> r[], <span class="keyword">int</span> sa[], <span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> i, j, p, *x = wa, *y = wb;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; ++i) ws[i] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) ws[x[i]=r[i]]++;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; m; ++i) ws[i] += ws[i<span class="number">-1</span>];</div><div class="line">    <span class="keyword">for</span> (i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) sa[--ws[x[i]]] = i;</div><div class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>, p = <span class="number">1</span>; p &lt; n; j *= <span class="number">2</span>, m = p)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span> (p = <span class="number">0</span>, i = n - j; i &lt; n; ++i) y[p++] = i;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">if</span> (sa[i] &gt;= j) y[p++] = sa[i] - j;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) wv[i] = x[y[i]];</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; ++i) ws[i] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) ws[wv[i]]++;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; m; ++i) ws[i] += ws[i<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span> (i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) sa[--ws[wv[i]]] = y[i];</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">std</span>::swap(x, y), p = <span class="number">1</span>, x[sa[<span class="number">0</span>]] = <span class="number">0</span>, i = <span class="number">1</span>; i &lt; n; ++i)</div><div class="line">            x[sa[i]] = cmp(y, sa[i<span class="number">-1</span>], sa[i], j) ? p<span class="number">-1</span> : p++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">calheight</span><span class="params">(<span class="keyword">int</span> r[], <span class="keyword">int</span> sa[], <span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> i, j, k = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) rank[sa[i]] = i;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; height[rank[i++]] = k)</div><div class="line">        <span class="keyword">for</span> (k?k--:<span class="number">0</span>, j = sa[rank[i]<span class="number">-1</span>]; r[i+k] == r[j+k]; k++);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//DC3版</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="keyword">int</span>(<span class="number">3e6</span>)+<span class="number">10</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = maxn;</div><div class="line"></div><div class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(x) ((x)/3+((x)%3==1?0:tb))</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">define</span> G(x) ((x)&lt;tb?(x)*3+1:((x)-tb)*3+2)</span></div><div class="line">    <span class="keyword">int</span> wa[maxn],wb[maxn],wv[maxn],ws[maxn];</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">c0</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></div><div class="line">    &#123;<span class="keyword">return</span> r[a]==r[b]&amp;&amp;r[a+<span class="number">1</span>]==r[b+<span class="number">1</span>]&amp;&amp;r[a+<span class="number">2</span>]==r[b+<span class="number">2</span>];&#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">c12</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> *r,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></div><div class="line">    &#123;<span class="keyword">if</span>(k==<span class="number">2</span>) <span class="keyword">return</span> r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;c12(<span class="number">1</span>,r,a+<span class="number">1</span>,b+<span class="number">1</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;wv[a+<span class="number">1</span>]&lt;wv[b+<span class="number">1</span>];&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> *a,<span class="keyword">int</span> *b,<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) wv[i]=r[a[i]];</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;m;i++) ws[i]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) ws[wv[i]]++;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;m;i++) ws[i]+=ws[i<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span>(i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) b[--ws[wv[i]]]=a[i];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dc3</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> *sa,<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span> <span class="comment">//涵义与DA 相同</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> i,j,*rn=r+n,*san=sa+n,ta=<span class="number">0</span>,tb=(n+<span class="number">1</span>)/<span class="number">3</span>,tbc=<span class="number">0</span>,p;</div><div class="line">        r[n]=r[n+<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i%<span class="number">3</span>!=<span class="number">0</span>) wa[tbc++]=i;</div><div class="line">        sort(r+<span class="number">2</span>,wa,wb,tbc,m);</div><div class="line">        sort(r+<span class="number">1</span>,wb,wa,tbc,m);</div><div class="line">        sort(r,wa,wb,tbc,m);</div><div class="line">        <span class="keyword">for</span>(p=<span class="number">1</span>,rn[F(wb[<span class="number">0</span>])]=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;tbc;i++)</div><div class="line">        rn[F(wb[i])]=c0(r,wb[i<span class="number">-1</span>],wb[i])?p<span class="number">-1</span>:p++;</div><div class="line">        <span class="keyword">if</span>(p&lt;tbc) dc3(rn,san,tbc,p);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;tbc;i++) san[rn[i]]=i;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;tbc;i++) <span class="keyword">if</span>(san[i]&lt;tb) wb[ta++]=san[i]*<span class="number">3</span>;</div><div class="line">        <span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">1</span>) wb[ta++]=n<span class="number">-1</span>;</div><div class="line">        sort(r,wb,wa,ta,m);</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;tbc;i++) wv[wb[i]=G(san[i])]=i;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>,j=<span class="number">0</span>,p=<span class="number">0</span>;i&lt;ta &amp;&amp; j&lt;tbc;p++)</div><div class="line">        sa[p]=c12(wb[j]%<span class="number">3</span>,r,wa[i],wb[j])?wa[i++]:wb[j++];</div><div class="line">        <span class="keyword">for</span>(;i&lt;ta;p++) sa[p]=wa[i++];</div><div class="line">        <span class="keyword">for</span>(;j&lt;tbc;p++) sa[p]=wb[j++];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="矩阵相交面积——线段树"><a href="#矩阵相交面积——线段树" class="headerlink" title="矩阵相交面积——线段树"></a>矩阵相交面积——线段树</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 222</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></div><div class="line">    <span class="keyword">double</span> x,y;</div><div class="line">    Point(<span class="keyword">double</span> x=<span class="number">0</span>,<span class="keyword">double</span> y=<span class="number">0</span>):x(x),y(y) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">in</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>,&amp;x,&amp;y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Point A[maxn],B[maxn];</div><div class="line"><span class="keyword">double</span> va[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span>&#123;</span></div><div class="line">    <span class="keyword">double</span> sumv[maxn*<span class="number">4</span>];</div><div class="line">    <span class="keyword">int</span> addv[maxn*<span class="number">4</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">        sumv[o]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(addv[o]) sumv[o]=va[R]-va[L<span class="number">-1</span>];</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(R&gt;L) sumv[o]=sumv[o*<span class="number">2</span>]+sumv[o*<span class="number">2</span>+<span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> qL,<span class="keyword">int</span> qR,<span class="keyword">double</span> v)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(L==R)&#123;</div><div class="line">            addv[o]+=v;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">int</span> M=L+(R-L)/<span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span>(qL&lt;=M) update(o*<span class="number">2</span>,L,M,qL,qR,v);</div><div class="line">            <span class="keyword">if</span>(qR&gt;M) update(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R,qL,qR,v);</div><div class="line">        &#125;</div><div class="line">        maintain(o,L,R);</div><div class="line">        <span class="comment">//printf("~~%d %d %d %f %d\n",o,L,R,sumv[o],addv[o]);</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">SegTree T;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> l,r;</div><div class="line">    <span class="keyword">double</span> h;</div><div class="line">    <span class="keyword">int</span> d;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Line &amp;a) <span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> h&lt;a.h;</div><div class="line">    &#125;</div><div class="line">&#125;line[maxn];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> n,kase=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)&amp;&amp;n)&#123;</div><div class="line">        <span class="keyword">int</span> len=<span class="number">1</span>,k=<span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(&amp;T,<span class="number">0</span>,<span class="keyword">sizeof</span>(T));</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">            A[i].in();B[i].in();</div><div class="line">            va[len++]=A[i].x;</div><div class="line">            va[len++]=B[i].x;</div><div class="line">        &#125;</div><div class="line">        sort(va+<span class="number">1</span>,va+len);</div><div class="line">        len=unique(va+<span class="number">1</span>,va+len)-va;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">            <span class="keyword">int</span> x1=lower_bound(va+<span class="number">1</span>,va+len,A[i].x)-va;</div><div class="line">            <span class="keyword">int</span> x2=lower_bound(va+<span class="number">1</span>,va+len,B[i].x)-va;</div><div class="line">            line[k++]=(Line)&#123;x1,x2,A[i].y,<span class="number">1</span>&#125;;</div><div class="line">            line[k++]=(Line)&#123;x1,x2,B[i].y,<span class="number">-1</span>&#125;;</div><div class="line">        &#125;</div><div class="line">        sort(line,line+k);</div><div class="line">        <span class="keyword">double</span> ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;k<span class="number">-1</span>;i++)&#123;</div><div class="line">            T.update(<span class="number">1</span>,<span class="number">1</span>,len,line[i].l+<span class="number">1</span>,line[i].r,line[i].d);</div><div class="line">            <span class="comment">//printf("%d %d %f %d %f\n",line[i].l,line[i].r,line[i].h,line[i].d,T.sumv[1]);</span></div><div class="line">            ans+=T.sumv[<span class="number">1</span>]*(line[i+<span class="number">1</span>].h-line[i].h);</div><div class="line">            <span class="comment">//printf(" %f\n",ans);</span></div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Test case #%d\nTotal explored area: %.2f\n\n"</span>,++kase,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">4</div><div class="line">0 0 5 5</div><div class="line">4 4 6 6</div><div class="line">5 5 7 7</div><div class="line">0 0 2 2</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="矩阵周长——线段树"><a href="#矩阵周长——线段树" class="headerlink" title="矩阵周长——线段树"></a>矩阵周长——线段树</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 10001</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 20010</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Poll</span>&#123;</span></div><div class="line">    ll x,y;</div><div class="line">    Poll(ll x=<span class="number">0</span>,ll y=<span class="number">0</span>):x(x),y(y) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">in</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>,&amp;x,&amp;y);</div><div class="line">        x+=N;y+=N;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Poll A[maxn],B[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span>&#123;</span></div><div class="line">    ll sumv[maxn*<span class="number">4</span>],addv[maxn*<span class="number">4</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mallain</span><span class="params">(ll o,ll L,ll R)</span></span>&#123;</div><div class="line">        sumv[o]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(addv[o]) sumv[o]=R-L+<span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(R&gt;L) sumv[o]=sumv[o*<span class="number">2</span>]+sumv[o*<span class="number">2</span>+<span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ll o,ll L,ll R,ll qL,ll qR,ll v)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(qL&lt;=L&amp;&amp;R&lt;=qR)&#123;</div><div class="line">            addv[o]+=v;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            ll M=L+(R-L)/<span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span>(qL&lt;=M) update(o*<span class="number">2</span>,L,M,qL,qR,v);</div><div class="line">            <span class="keyword">if</span>(qR&gt;M) update(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R,qL,qR,v);</div><div class="line">        &#125;</div><div class="line">        mallain(o,L,R);</div><div class="line">        <span class="comment">//prllf("---%d %d %d %d\n",L,R,sumv[o],addv[o]);</span></div><div class="line">    &#125;</div><div class="line">    <span class="function">ll <span class="title">query</span><span class="params">(ll o,ll L,ll R,ll qL,ll qR)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(addv[o]) <span class="keyword">return</span> min(R,qR)-max(L,qL)+<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(qL&lt;=L&amp;&amp;R&lt;=qR) <span class="keyword">return</span> sumv[o];</div><div class="line">        ll M=L+(R-L)/<span class="number">2</span>;</div><div class="line">        ll ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(qL&lt;=M) ans+=query(o*<span class="number">2</span>,L,M,qL,qR);</div><div class="line">        <span class="keyword">if</span>(qR&gt;M) ans+=query(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R,qL,qR);</div><div class="line">        <span class="keyword">return</span> ans;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">SegTree T;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span>&#123;</span></div><div class="line">    ll l,r;</div><div class="line">    ll h;</div><div class="line">    ll d;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Line &amp;a) <span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> h&lt;a.h||h==a.h&amp;&amp;d&gt;a.d;</div><div class="line">    &#125;</div><div class="line">&#125;H[maxn],W[maxn];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    ll n;</div><div class="line"><span class="comment">//    freopen("data.txt","r",stdin);</span></div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;n))&#123;</div><div class="line">        ll a=<span class="number">0</span>,b=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">            A[i].in();B[i].in();</div><div class="line">            H[a++]=(Line)&#123;A[i].x,B[i].x,A[i].y,<span class="number">1</span>&#125;;</div><div class="line">            H[a++]=(Line)&#123;A[i].x,B[i].x,B[i].y,<span class="number">-1</span>&#125;;</div><div class="line">            W[b++]=(Line)&#123;A[i].y,B[i].y,A[i].x,<span class="number">1</span>&#125;;</div><div class="line">            W[b++]=(Line)&#123;A[i].y,B[i].y,B[i].x,<span class="number">-1</span>&#125;;</div><div class="line">        &#125;</div><div class="line">        sort(H,H+a);sort(W,W+b);</div><div class="line">        ll ans=<span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(&amp;T,<span class="number">0</span>,<span class="keyword">sizeof</span>(T));</div><div class="line">        <span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;a;i++)&#123;</div><div class="line">            ll l=H[i].l,r=H[i].r;</div><div class="line">            ans+=r-l-T.query(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>*N,l+<span class="number">1</span>,r);</div><div class="line">            <span class="comment">//prllf("%d %d %d %d\n",l,r,H[i].d,T.query(1,1,2*N,l+1,r));</span></div><div class="line">            T.update(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>*N,l+<span class="number">1</span>,r,H[i].d);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">memset</span>(&amp;T,<span class="number">0</span>,<span class="keyword">sizeof</span>(T));</div><div class="line">        <span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;b;i++)&#123;</div><div class="line">            ll l=W[i].l,r=W[i].r;</div><div class="line">            ans+=r-l-T.query(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>*N,l+<span class="number">1</span>,r);</div><div class="line">            <span class="comment">//printf("%lld %lld %lld %lld\n",l,r,T.query(1,1,2*N,l+1,r),ans);</span></div><div class="line">            T.update(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>*N,l+<span class="number">1</span>,r,W[i].d);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans*<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">2</div><div class="line">0 0 5 3</div><div class="line">5 0 6 3</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="康拓展开"><a href="#康拓展开" class="headerlink" title="康拓展开"></a>康拓展开</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"> 一、康托展开：全排列到一个自然数的双射</div><div class="line"> </div><div class="line">X=an*(n<span class="number">-1</span>)!+an<span class="number">-1</span>*(n<span class="number">-2</span>)!+...+ai*(i<span class="number">-1</span>)!+...+a2*<span class="number">1</span>!+a1*<span class="number">0</span>!</div><div class="line"> </div><div class="line">ai为整数，并且<span class="number">0</span>&lt;=ai&lt;i(<span class="number">1</span>&lt;=i&lt;=n)</div><div class="line"> </div><div class="line"> 适用范围：没有重复元素的全排列</div><div class="line"> </div><div class="line"> </div><div class="line">二、全排列的编码：</div><div class="line"> </div><div class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,...,n&#125;的排列总共有n!种，将它们从小到大排序，怎样知道其中一种排列是有序序列中的第几个？</div><div class="line"> </div><div class="line">如 &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; 按从小到大排列一共<span class="number">6</span>个：<span class="number">123</span> <span class="number">132</span> <span class="number">213</span> <span class="number">231</span> <span class="number">312</span> <span class="number">321</span>。想知道<span class="number">321</span>是&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;中第几个大的数。</div><div class="line"> </div><div class="line">这样考虑：第一位是<span class="number">3</span>，小于<span class="number">3</span>的数有<span class="number">1</span>、<span class="number">2</span> 。所以有<span class="number">2</span>*<span class="number">2</span>!个。再看小于第二位，小于<span class="number">2</span>的数只有一个就是<span class="number">1</span> ，所以有<span class="number">1</span>*<span class="number">1</span>!=<span class="number">1</span> 所以小于<span class="number">32</span></div><div class="line"> </div><div class="line">的&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;排列数有<span class="number">2</span>*<span class="number">2</span>!+<span class="number">1</span>*<span class="number">1</span>!=<span class="number">5</span>个。所以<span class="number">321</span>是第<span class="number">6</span>个大的数。<span class="number">2</span>*<span class="number">2</span>!+<span class="number">1</span>*<span class="number">1</span>!是康托展开。（注意判断排列是第几个时要在康托展开的结果后+<span class="number">1</span>）</div><div class="line"> </div><div class="line">再举个例子：<span class="number">1324</span>是&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;排列数中第几个大的数：第一位是<span class="number">1</span>小于<span class="number">1</span>的数没有，是<span class="number">0</span>个，<span class="number">0</span>*<span class="number">3</span>!，第二位是<span class="number">3</span>小于<span class="number">3</span>的数有<span class="number">1</span>和<span class="number">2</span>，但<span class="number">1</span>已经在第一位了，所以只有一个数<span class="number">2</span>，<span class="number">1</span>*<span class="number">2</span>! 。第三位是<span class="number">2</span>小于<span class="number">2</span>的数是<span class="number">1</span>，但<span class="number">1</span>在第一位，所以有<span class="number">0</span>个数，<span class="number">0</span>*<span class="number">1</span>!，所以比<span class="number">1324</span>小的排列有<span class="number">0</span>*<span class="number">3</span>!+<span class="number">1</span>*<span class="number">2</span>!+<span class="number">0</span>*<span class="number">1</span>!=<span class="number">2</span>个，<span class="number">1324</span>是第三个大数。</div><div class="line"> </div><div class="line">又例如，排列<span class="number">3</span> <span class="number">5</span> <span class="number">7</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">9</span> <span class="number">6</span> <span class="number">8</span>展开为<span class="number">98884</span>，因为X=<span class="number">2</span>*<span class="number">8</span>!+<span class="number">3</span>*<span class="number">7</span>!+<span class="number">4</span>*<span class="number">6</span>!+<span class="number">2</span>*<span class="number">5</span>!+<span class="number">0</span>*<span class="number">4</span>!+<span class="number">0</span>*<span class="number">3</span>!+<span class="number">2</span>*<span class="number">2</span>!+<span class="number">0</span>*<span class="number">1</span>!+<span class="number">0</span>*<span class="number">0</span>!=<span class="number">98884.</span></div><div class="line"> </div><div class="line">解释：</div><div class="line"> </div><div class="line">排列的第一位是<span class="number">3</span>，比<span class="number">3</span>小的数有两个，以这样的数开始的排列有<span class="number">8</span>!个，因此第一项为<span class="number">2</span>*<span class="number">8</span>!</div><div class="line"> </div><div class="line">排列的第二位是<span class="number">5</span>，比<span class="number">5</span>小的数有<span class="number">1</span>、<span class="number">2</span>、<span class="number">3</span>、<span class="number">4</span>，由于<span class="number">3</span>已经出现，因此共有<span class="number">3</span>个比<span class="number">5</span>小的数，这样的排列有<span class="number">7</span>!个，因此第二项为<span class="number">3</span>*<span class="number">7</span>!</div><div class="line"> </div><div class="line">以此类推，直至<span class="number">0</span>*<span class="number">0</span>!</div><div class="line"> </div><div class="line"></div><div class="line">#include&lt;cstdio&gt;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> fac[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>, <span class="number">720</span>, <span class="number">5040</span>, <span class="number">40320</span>&#125;;<span class="comment">///阶乘</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">KT</span><span class="params">(<span class="keyword">int</span> s[], <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i, j, cnt, sum;</div><div class="line">    sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">        cnt = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; n; ++j)</div><div class="line">            <span class="keyword">if</span> (s[j] &lt; s[i]) ++cnt;</div><div class="line">        sum += cnt * fac[n - i - <span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a[] = &#123;<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>&#125;;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">1</span> + KT(a, <span class="keyword">sizeof</span>(a) / <span class="keyword">sizeof</span>(*a))); <span class="comment">///1+98884</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">三、全排列的解码</div><div class="line">如何找出第<span class="number">16</span>个（按字典序的）&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;的全排列？</div><div class="line"> </div><div class="line"><span class="number">1.</span> 首先用<span class="number">16</span><span class="number">-1</span>得到<span class="number">15</span></div><div class="line"> </div><div class="line"><span class="number">2.</span> 用<span class="number">15</span>去除<span class="number">4</span>! 得到<span class="number">0</span>余<span class="number">15</span></div><div class="line"> </div><div class="line"><span class="number">3.</span> 用<span class="number">15</span>去除<span class="number">3</span>! 得到<span class="number">2</span>余<span class="number">3</span></div><div class="line"> </div><div class="line"><span class="number">4.</span> 用<span class="number">3</span>去除<span class="number">2</span>! 得到<span class="number">1</span>余<span class="number">1</span></div><div class="line"> </div><div class="line"><span class="number">5.</span> 用<span class="number">1</span>去除<span class="number">1</span>! 得到<span class="number">1</span>余<span class="number">0</span></div><div class="line"> </div><div class="line">有<span class="number">0</span>个数比它小的数是<span class="number">1</span>，所以第一位是<span class="number">1</span></div><div class="line"> </div><div class="line">有<span class="number">2</span>个数比它小的数是<span class="number">3</span>，但<span class="number">1</span>已经在之前出现过了所以是<span class="number">4</span></div><div class="line"> </div><div class="line">有<span class="number">1</span>个数比它小的数是<span class="number">2</span>，但<span class="number">1</span>已经在之前出现过了所以是<span class="number">3</span></div><div class="line"> </div><div class="line">有<span class="number">1</span>个数比它小的数是<span class="number">2</span>，但<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>都出现过了所以是<span class="number">5</span></div><div class="line"> </div><div class="line">最后一个数只能是<span class="number">2</span></div><div class="line"> </div><div class="line">所以排列为<span class="number">1</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">2</span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> fac[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>, <span class="number">720</span>, <span class="number">5040</span>, <span class="number">40320</span>&#125;;<span class="comment">///阶乘</span></div><div class="line"></div><div class="line"><span class="keyword">bool</span> vis[<span class="number">10</span>];</div><div class="line"></div><div class="line"><span class="comment">///n为ans大小，k为全排列的编码</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">invKT</span><span class="params">(<span class="keyword">int</span> ans[], <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i, j, t;</div><div class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</div><div class="line">    --k;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">        t = k / fac[n - i - <span class="number">1</span>];</div><div class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= n; j++)</div><div class="line">            <span class="keyword">if</span> (!vis[j]) &#123;</div><div class="line">                <span class="keyword">if</span> (t == <span class="number">0</span>) <span class="keyword">break</span>;</div><div class="line">                --t;</div><div class="line">            &#125;</div><div class="line">        ans[i] = j, vis[j] = <span class="literal">true</span>;</div><div class="line">        k %= fac[n - i - <span class="number">1</span>];<span class="comment">///余数</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a[<span class="number">10</span>];</div><div class="line">    invKT(a, <span class="number">5</span>, <span class="number">16</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, a[i]);<span class="comment">///1 4 3 5 2</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="莫队算法"><a href="#莫队算法" class="headerlink" title="莫队算法"></a>莫队算法</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">Query</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> L, R, ID, block;</div><div class="line">    Query()&#123;&#125;　　<span class="comment">// 构造函数重载</span></div><div class="line">    Query(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ID):L(l), R(r), ID(ID)&#123;</div><div class="line">        block = l / len;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query rhs) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span>(block == rhs.block) <span class="keyword">return</span> R &lt; rhs.R;　　<span class="comment">// 不是if(L == rhs.L) return R &lt; rhs.R; return L &lt; rhs.L</span></div><div class="line">        <span class="keyword">return</span> block &lt; rhs.block;　　　　　　　　　　 <span class="comment">// 否则这就变回算法一了</span></div><div class="line">    &#125;</div><div class="line">&#125;queries[maxm];</div><div class="line"></div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; buf;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(buf.count(n))</div><div class="line">        ++buf[n];</div><div class="line">    <span class="keyword">else</span></div><div class="line">        buf[n] = <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(--buf[n] == <span class="number">0</span>) buf.erase(n);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> A[maxn];　　　　　　　　<span class="comment">// 原序列</span></div><div class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; anss[maxm];　　<span class="comment">// 存储答案</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">    len = (<span class="keyword">int</span>)<span class="built_in">sqrt</span>(n);　　　　<span class="comment">// 块长度</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; A[i];</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; m;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</div><div class="line">        <span class="keyword">int</span> l, r;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r;</div><div class="line">        queries[i] = Query(l, r, i);</div><div class="line">    &#125;</div><div class="line">    sort(queries + <span class="number">1</span>, queries + m + <span class="number">1</span>);</div><div class="line">    <span class="keyword">int</span> L = <span class="number">1</span>, R = <span class="number">1</span>;</div><div class="line">    buf[A[<span class="number">1</span>]] = <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</div><div class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;&amp; ans = anss[queries[i].ID];</div><div class="line">        Query &amp;qi = queries[i];</div><div class="line">        <span class="keyword">while</span>(R &lt; qi.R) insert(A[++R]);</div><div class="line">        <span class="keyword">while</span>(L &gt; qi.L) insert(A[--L]);</div><div class="line">        <span class="keyword">while</span>(R &gt; qi.R) erase(A[R--]);</div><div class="line">        <span class="keyword">while</span>(L &lt; qi.L) erase(A[L++]);</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator it = buf.begin(); it != buf.end(); ++it)&#123;</div><div class="line">            <span class="keyword">if</span>(it-&gt;second &gt;= <span class="number">2</span>)&#123;</div><div class="line">                ans.push(it-&gt;first);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</div><div class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;&amp; ans = anss[i];</div><div class="line">        <span class="keyword">while</span>(!ans.empty())&#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; ans.front() &lt;&lt; <span class="string">' '</span>;</div><div class="line">            ans.pop();</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="树分治"><a href="#树分治" class="headerlink" title="树分治"></a>树分治</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line">  给一棵树,每条边有权.求一条简单路径,权值和等于K,且边的数量最小.N &lt;= 200000, K &lt;= 1000000</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 0x3f3f3f3f</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> y,v,next;</div><div class="line">&#125; e[maxn*<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> n,k,len,root,sum,ans=inf,Link[maxn],f[maxn],vis[maxn],son[maxn];</div><div class="line">ll d[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P</span>&#123;</span></div><div class="line">    ll s;</div><div class="line">    <span class="keyword">int</span> ed,h;</div><div class="line">    P(ll s=<span class="number">0</span>,<span class="keyword">int</span> ed=<span class="number">0</span>,<span class="keyword">int</span> h=<span class="number">0</span>):s(s),ed(ed),h(h) &#123;&#125;;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> P &amp;rhs)<span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> s&lt;rhs.s;</div><div class="line">    &#125;</div><div class="line">&#125;t[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> ch=getchar();</div><div class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))  &#123;</div><div class="line">        <span class="keyword">if</span>(ch==<span class="string">'-'</span>)  f=<span class="number">-1</span>;</div><div class="line">        ch=getchar();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))  &#123;</div><div class="line">        x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;</div><div class="line">        ch=getchar();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    e[++len].next=Link[x];</div><div class="line">    Link[x]=len;</div><div class="line">    e[len].y=y;</div><div class="line">    e[len].v=v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getroot</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span> </span>&#123;</div><div class="line">    son[x]=<span class="number">1</span>;</div><div class="line">    f[x]=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x]; i; i=e[i].next) &#123;</div><div class="line">        <span class="keyword">if</span>(e[i].y==fa||vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        getroot(e[i].y,x);</div><div class="line">        son[x]+=son[e[i].y];</div><div class="line">        f[x]=max(f[x],son[e[i].y]);</div><div class="line">    &#125;</div><div class="line">    f[x]=max(f[x],sum-son[x]);</div><div class="line">    <span class="keyword">if</span>(f[x]&lt;f[root])  root=x;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> L=<span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getdeep</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa,<span class="keyword">int</span> pre,<span class="keyword">int</span> ed)</span> </span>&#123;</div><div class="line">    t[L++]=P(d[x],ed,pre);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x]; i; i=e[i].next) &#123;</div><div class="line">        <span class="keyword">if</span>(e[i].y==fa||vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        d[e[i].y]=d[x]+e[i].v;</div><div class="line">        getdeep(e[i].y,x,pre,ed+<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    d[x]=L=<span class="number">0</span>;</div><div class="line">    t[L++]=P(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x]; i; i=e[i].next)&#123;</div><div class="line">        <span class="keyword">if</span>(!vis[e[i].y])&#123;</div><div class="line">            d[e[i].y]=e[i].v;</div><div class="line">            getdeep(e[i].y,x,e[i].y,<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    sort(t,t+L);</div><div class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=L<span class="number">-1</span>;</div><div class="line">    <span class="keyword">while</span>(l&lt;r)&#123;</div><div class="line">        <span class="keyword">if</span>(t[r].s+t[l].s&gt;k) r--;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=r;i&gt;l;i--)&#123;</div><div class="line">                <span class="keyword">if</span>(t[i].s+t[l].s&lt;k) <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">if</span>(t[i].h==t[l].h) <span class="keyword">continue</span>;</div><div class="line">                ans=min(ans,t[i].ed+t[l].ed);</div><div class="line">            &#125;</div><div class="line">            l++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    vis[x]=<span class="number">1</span>;</div><div class="line">    cal(x);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x]; i; i=e[i].next) &#123;</div><div class="line">        <span class="keyword">if</span>(vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        root=<span class="number">0</span>;</div><div class="line">        sum=son[e[i].y];</div><div class="line">        getroot(e[i].y,<span class="number">0</span>);</div><div class="line">        solve(root);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    n=read();k=read();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="keyword">int</span> x=read(),y=read(),v=read();</div><div class="line">        x++;y++;</div><div class="line">        insert(x,y,v);</div><div class="line">        insert(y,x,v);</div><div class="line">    &#125;</div><div class="line">    sum=n;</div><div class="line">    f[<span class="number">0</span>]=n;</div><div class="line">    getroot(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">    solve(root);</div><div class="line">    <span class="keyword">if</span>(ans&gt;=n) <span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</div><div class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">4 3</div><div class="line">0 1 1</div><div class="line">1 2 2</div><div class="line">1 3 4</div><div class="line">*/</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7fffffff</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> y,v,next;&#125;e[<span class="number">20010</span>];</div><div class="line"><span class="keyword">int</span> n,len,k,root,sum,ans,Link[<span class="number">10010</span>],f[<span class="number">10010</span>],vis[<span class="number">10010</span>],son[<span class="number">10010</span>],d[<span class="number">10010</span>],deep[<span class="number">10010</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;  <span class="keyword">char</span> ch=getchar();</div><div class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))  &#123;<span class="keyword">if</span>(ch==<span class="string">'-'</span>)  f=<span class="number">-1</span>;  ch=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))  &#123;x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;  ch=getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> v)</span></span></div><div class="line">&#123;</div><div class="line">    e[++len].next=Link[x];</div><div class="line">    Link[x]=len;</div><div class="line">    e[len].v=v;</div><div class="line">    e[len].y=y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getroot</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span></div><div class="line">&#123;</div><div class="line">    son[x]=<span class="number">1</span>;  f[x]=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x];i;i=e[i].next)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(e[i].y==fa||vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        getroot(e[i].y,x);</div><div class="line">        son[x]+=son[e[i].y];</div><div class="line">        f[x]=max(f[x],son[e[i].y]);</div><div class="line">    &#125;</div><div class="line">    f[x]=max(f[x],sum-son[x]);</div><div class="line">    <span class="keyword">if</span>(f[x]&lt;f[root])  root=x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getdeep</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span></div><div class="line">&#123;</div><div class="line">    deep[++deep[<span class="number">0</span>]]=d[x];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x];i;i=e[i].next)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(e[i].y==fa||vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        d[e[i].y]=d[x]+e[i].v;</div><div class="line">        getdeep(e[i].y,x);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> v)</span></span></div><div class="line">&#123;</div><div class="line">    d[x]=v;  deep[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">    getdeep(x,<span class="number">0</span>);</div><div class="line">    sort(deep+<span class="number">1</span>,deep+deep[<span class="number">0</span>]+<span class="number">1</span>);</div><div class="line">    <span class="keyword">int</span> l=<span class="number">1</span>,r=deep[<span class="number">0</span>],sum=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(l&lt;r)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(deep[l]+deep[r]&lt;=k)  &#123;sum+=r-l;  l++;&#125;</div><div class="line">        <span class="keyword">else</span> r--;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">    ans+=cal(x,<span class="number">0</span>);<span class="comment">//计算答案</span></div><div class="line">    vis[x]=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=Link[x];i;i=e[i].next)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(vis[e[i].y])  <span class="keyword">continue</span>;</div><div class="line">        ans-=cal(e[i].y,e[i].v);<span class="comment">//计算不符合题意的答案</span></div><div class="line">        sum=son[e[i].y];</div><div class="line">        root=<span class="number">0</span>;</div><div class="line">        getroot(e[i].y,<span class="number">0</span>);</div><div class="line">        solve(root);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    freopen(<span class="string">"cin.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"cout.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        ans=<span class="number">0</span>,root=<span class="number">0</span>,len=<span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</div><div class="line">        <span class="built_in">memset</span>(Link,<span class="number">0</span>,<span class="keyword">sizeof</span>(Link));</div><div class="line">        n=read();  k=read();</div><div class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>&amp;&amp;k==<span class="number">0</span>)  <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> x=read(),y=read(),v=read();</div><div class="line">            insert(x,y,v);   insert(y,x,v);</div><div class="line">        &#125;</div><div class="line">        f[<span class="number">0</span>]=INF;  sum=n;</div><div class="line">        getroot(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">        solve(root);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line"> CHANGE a b : change the cost of the a-th edge to b</div><div class="line"> QUERY a b : ask for the maximum edge cost on the path from node a to node b </div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10010</span></div><div class="line"><span class="keyword">int</span> size[maxn],dep[maxn],val[maxn],id[maxn],hson[maxn],top[maxn],fa[maxn];<span class="comment">//定义</span></div><div class="line"><span class="keyword">int</span> num;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; g[maxn];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tree</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> x,y,z;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</div><div class="line">        g[x].push_back(y);</div><div class="line">        g[y].push_back(x);</div><div class="line">    &#125;</div><div class="line">&#125; e[maxn]; <span class="comment">//起点重点权值</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> maxv[maxn*<span class="number">4</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(L==R)&#123;</div><div class="line">            maxv[o]=val[L];</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">int</span> M=(L+R)/<span class="number">2</span>;</div><div class="line">            build(o*<span class="number">2</span>,L,M);build(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R);</div><div class="line">            maxv[o]=max(maxv[o*<span class="number">2</span>],maxv[o*<span class="number">2</span>+<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> p,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(L==R) maxv[o]=v;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">int</span> M=(L+R)/<span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span>(p&lt;=M) update(o*<span class="number">2</span>,L,M,p,v);</div><div class="line">            <span class="keyword">else</span> update(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R,p,v);</div><div class="line">            maxv[o]=max(maxv[o*<span class="number">2</span>],maxv[o*<span class="number">2</span>+<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> qL,<span class="keyword">int</span> qR)</span></span>&#123;</div><div class="line"><span class="comment">//        printf("%d %d %d %d\n",L,R,qL,qR);</span></div><div class="line">        <span class="keyword">if</span>(qL&lt;=L&amp;&amp;R&lt;=qR) <span class="keyword">return</span> maxv[o];</div><div class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>,M=(L+R)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span>(qL&lt;=M) ans=max(ans,query(o*<span class="number">2</span>,L,M,qL,qR));</div><div class="line">        <span class="keyword">if</span>(qR&gt;M) ans=max(ans,query(o*<span class="number">2</span>+<span class="number">1</span>,M+<span class="number">1</span>,R,qL,qR));</div><div class="line">        <span class="keyword">return</span> ans;</div><div class="line">    &#125;</div><div class="line">&#125;T;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> d,<span class="keyword">int</span> f,<span class="keyword">int</span> u)</span> </span>&#123; <span class="comment">//d：深度 f:父节点 u：当前节点</span></div><div class="line">    dep[u]=d;</div><div class="line">    size[u]=<span class="number">1</span>;</div><div class="line">    hson[u]=<span class="number">0</span>;</div><div class="line">    fa[u]=f;</div><div class="line">    <span class="keyword">for</span>(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it=g[u].begin(); it!=g[u].end(); it++) &#123;</div><div class="line">        <span class="keyword">if</span>(*it==f) <span class="keyword">continue</span>;</div><div class="line">        dfs1(d+<span class="number">1</span>,u,*it);</div><div class="line">        size[u]+=size[*it];</div><div class="line">        <span class="keyword">if</span>(size[hson[u]]&lt;size[*it])</div><div class="line">            hson[u]=*it;<span class="comment">//找重儿子</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> tp)</span> </span>&#123;</div><div class="line">    top[u]=tp;<span class="comment">//赋值top</span></div><div class="line">    id[u]=num++;<span class="comment">//赋值id</span></div><div class="line">    <span class="keyword">if</span>(hson[u]) dfs2(hson[u],tp);<span class="comment">//优先重儿子</span></div><div class="line">    <span class="keyword">for</span>(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it=g[u].begin(); it!=g[u].end(); it++) &#123;</div><div class="line">        <span class="keyword">if</span>(*it==fa[u]||*it==hson[u]) <span class="keyword">continue</span>;</div><div class="line">        dfs2(*it,*it);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> t1=top[u],t2=top[v];</div><div class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(t1!=t2) &#123;</div><div class="line">        <span class="keyword">if</span>(dep[t1]&lt;dep[t2]) &#123;</div><div class="line">            swap(t1,t2);</div><div class="line">            swap(u,v);</div><div class="line">        &#125;</div><div class="line">        ans=max(T.query(<span class="number">1</span>,<span class="number">2</span>,n,id[t1],id[u]),ans);</div><div class="line">        u=fa[t1];</div><div class="line">        t1=top[u];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(u==v) <span class="keyword">return</span> ans;</div><div class="line">    <span class="keyword">if</span> (dep[u] &gt; dep[v]) swap(u, v);</div><div class="line">    ans = max(T.query(<span class="number">1</span>,<span class="number">2</span>,n,id[hson[u]], id[v]), ans);</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">    dfs2(<span class="number">1</span>,<span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(dep[e[i].x]&lt;dep[e[i].y])</div><div class="line">            swap(e[i].x, e[i].y);</div><div class="line">        val[id[e[i].x]] = e[i].z;</div><div class="line">    &#125;</div><div class="line">    T.build(<span class="number">1</span>,<span class="number">2</span>,n);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ca;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;ca);</div><div class="line">    <span class="keyword">while</span>(ca--) &#123;</div><div class="line">        <span class="keyword">int</span> n;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n+<span class="number">1</span>;i++) g[i].clear();</div><div class="line">        num=<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</div><div class="line">            e[i].init();</div><div class="line">        init(n);</div><div class="line">        <span class="keyword">char</span> op[<span class="number">15</span>];</div><div class="line">        <span class="keyword">int</span> a,b;</div><div class="line">        <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,op))&#123;</div><div class="line">            <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'D'</span>) <span class="keyword">break</span>;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</div><div class="line">            <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">'Q'</span>)&#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,find(a,b,n));</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                T.update(<span class="number">1</span>,<span class="number">2</span>,n,id[e[a].x],b);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">1</div><div class="line">3</div><div class="line">1 2 1</div><div class="line">2 3 2</div><div class="line">QUERY 1 2</div><div class="line">CHANGE 1 3</div><div class="line">QUERY 1 2</div><div class="line">DONE</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="树状数组区间修改"><a href="#树状数组区间修改" class="headerlink" title="树状数组区间修改"></a>树状数组区间修改</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line">原理：</div><div class="line">首先依旧是引入delta数组 delta[i]表示区间 [i, n] 的共同增量 于是修改区间 [l, r] 时修改 delta[l] 和 delta[r + 1] 即可（就是差分的思路）</div><div class="line">查询的时候是查询区间 [l, r] 的和 即sum[r] - sum[l - 1] 所以现在的问题是求sum[i]</div><div class="line">sum[i] = a[1]+...+a[i] + delta[1]*i + delta[2]*(i - 1) + delta[3]*(i - 2)+...+delta[i]*1   // a[i]为原始数组</div><div class="line">       = sigma( a[x] ) + sigma( delta[x]  *  (i + 1 - x) )</div><div class="line">       = sigma( a[x] ) + (i + 1) * sigma( delta[x] ) - sigma( delta[x] * x )</div><div class="line">*/</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(i) (i &amp; (-i))</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">readint</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> sign = <span class="number">1</span>, n = <span class="number">0</span>; <span class="keyword">char</span> c = getchar();</div><div class="line">	<span class="keyword">while</span>(c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)&#123; <span class="keyword">if</span>(c == <span class="string">'-'</span>) sign = <span class="number">-1</span>; c = getchar(); &#125;</div><div class="line">	<span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) &#123; n = n*<span class="number">10</span> + c-<span class="string">'0'</span>; c = getchar(); &#125;</div><div class="line">	<span class="keyword">return</span> sign*n;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> Nmax = <span class="number">200100</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N, Q;</div><div class="line"></div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> delta[Nmax]; <span class="comment">// delta的前缀和 </span></div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> deltai[Nmax]; <span class="comment">// delta * i的前缀和 </span></div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum[Nmax]; <span class="comment">// 原始前缀和</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">Query</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> *<span class="built_in">array</span>, <span class="keyword">int</span> pos)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">long</span> <span class="keyword">long</span> temp = <span class="number">0l</span>l;</div><div class="line">	<span class="keyword">while</span>(pos &gt; <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		temp += <span class="built_in">array</span>[pos];</div><div class="line">		pos -= lowbit(pos);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> temp;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> *<span class="built_in">array</span>, <span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">while</span>(pos &lt;= N)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">array</span>[pos] += x;</div><div class="line">		pos += lowbit(pos);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	N = readint();</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x = readint();</div><div class="line">		sum[i] = sum[i - <span class="number">1</span>] + x;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	Q = readint();</div><div class="line">	</div><div class="line">	<span class="keyword">while</span>(Q--)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> sign = readint();</div><div class="line">		<span class="keyword">if</span>(sign == <span class="number">1</span>) <span class="comment">// 修改：把[l, r]区间均加上x </span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> l = readint(), r = readint(), x = readint();</div><div class="line">			Update(delta, l, x);</div><div class="line">			Update(delta, r+<span class="number">1</span>, -x);</div><div class="line">			Update(deltai, l, x * l);</div><div class="line">			Update(deltai, r+<span class="number">1</span>, -x * (r+<span class="number">1</span>));</div><div class="line">		&#125; </div><div class="line">		<span class="keyword">else</span> <span class="comment">// 查询：[l, r]区间和 </span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> l = readint(), r = readint(); </div><div class="line">			<span class="keyword">long</span> <span class="keyword">long</span> suml = sum[l - <span class="number">1</span>] + l * Query(delta, l - <span class="number">1</span>) - Query(deltai, l - <span class="number">1</span>);</div><div class="line">			<span class="keyword">long</span> <span class="keyword">long</span> sumr = sum[r] + (r + <span class="number">1</span>) * Query(delta, r) - Query(deltai, r);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, sumr - suml);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数位dp"><a href="#数位dp" class="headerlink" title="数位dp"></a>数位dp</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//    pos    = 当前处理的位置(一般从高位到低位)</span></div><div class="line"><span class="comment">//    pre    = 上一个位的数字(更高的那一位)</span></div><div class="line"><span class="comment">//    status = 要达到的状态,如果为1则可以认为找到了答案,到时候用来返回,</span></div><div class="line"><span class="comment">//         　　 给计数器+1。</span></div><div class="line"><span class="comment">//    limit  = 是否受限,也即当前处理这位能否随便取值。如567,当前处理6这位,</span></div><div class="line"><span class="comment">//         　　 如果前面取的是4,则当前这位可以取0-9。如果前面取的5,那么当前</span></div><div class="line"><span class="comment">//         　　 这位就不能随便取，不然会超出这个数的范围,所以如果前面取5的</span></div><div class="line"><span class="comment">//         　　 话此时的limit=1,也就是说当前只可以取0-6。</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    用DP数组保存这三个状态是因为往后转移的时候会遇到很多重复的情况。</span></div><div class="line"><span class="function"><span class="keyword">int</span>    <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> pre,<span class="keyword">int</span> status,<span class="keyword">int</span> limit)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//已结搜到尽头,返回"是否找到了答案"这个状态。</span></div><div class="line">    <span class="keyword">if</span>(pos &lt; <span class="number">1</span>)</div><div class="line">        <span class="keyword">return</span>    status;</div><div class="line"></div><div class="line">    <span class="comment">//DP里保存的是完整的,也即不受限的答案,所以如果满足的话,可以直接返回。</span></div><div class="line">    <span class="keyword">if</span>(!limit &amp;&amp; DP[pos][pre][status] != <span class="number">-1</span>)</div><div class="line">        <span class="keyword">return</span>    DP[pos][pre][status];</div><div class="line"></div><div class="line">    <span class="keyword">int</span>    end = limit ? DIG[pos] : <span class="number">9</span>;</div><div class="line">    <span class="keyword">int</span>    ret = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//往下搜的状态表示的很巧妙,status用||是因为如果前面找到了答案那么后面</span></div><div class="line">    <span class="comment">//还有没有答案都无所谓了。而limti用&amp;&amp;是因为只有前面受限、当前受限才能</span></div><div class="line">    <span class="comment">//推出下一步也受限，比如567,如果是46X的情况,虽然6已经到尽头,但是后面的</span></div><div class="line">    <span class="comment">//个位仍然可以随便取,因为百位没受限,所以如果个位要受限,那么前面必须是56。</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">//这里用"不要49"一题来做例子。</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= end;i ++)</div><div class="line">        ret += dfs(pos - <span class="number">1</span>,i,status || (pre == <span class="number">4</span> &amp;&amp; i == <span class="number">9</span>),limit &amp;&amp; (i == end));</div><div class="line"></div><div class="line">    <span class="comment">//DP里保存完整的、取到尽头的数据</span></div><div class="line">    <span class="keyword">if</span>(!limit)</div><div class="line">        DP[pos][pre][status] = ret;</div><div class="line"></div><div class="line">    <span class="keyword">return</span>    ret;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="拓展KMP"><a href="#拓展KMP" class="headerlink" title="拓展KMP"></a>拓展KMP</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//C/C++ 模板</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">101010</span>;</div><div class="line"><span class="keyword">int</span> next[N],extand[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getnext</span><span class="params">(<span class="keyword">char</span> *T)</span> </span>&#123; <span class="comment">// next[i]: 以第i位置开始的子串 与 T的公共前缀</span></div><div class="line">    <span class="keyword">int</span> i,length = <span class="built_in">strlen</span>(T);</div><div class="line">    next[<span class="number">0</span>] = length;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i&lt;length<span class="number">-1</span> &amp;&amp; T[i]==T[i+<span class="number">1</span>]; i++);</div><div class="line">    next[<span class="number">1</span>] = i;</div><div class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">2</span>; k &lt; length; k++) &#123;</div><div class="line">        <span class="keyword">int</span> p = a+next[a]<span class="number">-1</span>, L = next[k-a];</div><div class="line">        <span class="keyword">if</span>( (k<span class="number">-1</span>)+L &gt;= p ) &#123;</div><div class="line">            <span class="keyword">int</span> j = (p-k+<span class="number">1</span>)&gt;<span class="number">0</span>? (p-k+<span class="number">1</span>) : <span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span>(k+j&lt;length &amp;&amp; T[k+j]==T[j]) j++;<span class="comment">// 枚举(p+1，length) 与(p-k+1,length) 区间比较</span></div><div class="line">            next[k] = j, a = k;</div><div class="line">        &#125; <span class="keyword">else</span> next[k] = L;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getextand</span><span class="params">(<span class="keyword">char</span> *S,<span class="keyword">char</span> *T)</span> </span>&#123;</div><div class="line">    <span class="built_in">memset</span>(next,<span class="number">0</span>,<span class="keyword">sizeof</span>(next));</div><div class="line">    getnext(T);</div><div class="line">    <span class="keyword">int</span> Slen = <span class="built_in">strlen</span>(S), Tlen = <span class="built_in">strlen</span>(T), a = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> MinLen = Slen&gt;Tlen?Tlen:Slen;</div><div class="line">    <span class="keyword">while</span>(a&lt;MinLen &amp;&amp; S[a]==T[a]) a++;</div><div class="line">    extand[<span class="number">0</span>] = a, a = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; Slen; k++) &#123;</div><div class="line">        <span class="keyword">int</span> p = a+extand[a]<span class="number">-1</span>, L = next[k-a];</div><div class="line">        <span class="keyword">if</span>( (k<span class="number">-1</span>)+L &gt;= p ) &#123;</div><div class="line">            <span class="keyword">int</span> j = (p-k+<span class="number">1</span>)&gt;<span class="number">0</span>? (p-k+<span class="number">1</span>) : <span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span>(k+j&lt;Slen &amp;&amp; j&lt;Tlen &amp;&amp; S[k+j]==T[j] ) j++;</div><div class="line">            extand[k] = j;</div><div class="line">            a = k;</div><div class="line">        &#125; <span class="keyword">else</span> extand[k] = L;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> s[N],t[N];</div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%s %s"</span>,s,t)) &#123;</div><div class="line">        getextand(s,t);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(t); i++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>,next[i]);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(s); i++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>,extand[i]);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">aaaabaaa aaaa</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="整体二分"><a href="#整体二分" class="headerlink" title="整体二分"></a>整体二分</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line">区间第K小</div><div class="line">*/</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 220000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 1000000000</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">query</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> x,y,k,s,tp,cur;</div><div class="line">&#125;q[maxn],q1[maxn],q2[maxn];</div><div class="line"><span class="keyword">int</span> a[maxn],ans[maxn],tmp[maxn],t[maxn];</div><div class="line"><span class="keyword">int</span> n,m,num,cnt;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=x;i&lt;=n;i+=(i&amp;-i)) t[i]+=y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> tmp=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=x;i&gt;<span class="number">0</span>;i-=(i&amp;-i)) tmp+=t[i];</div><div class="line">    <span class="keyword">return</span> tmp;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> head,<span class="keyword">int</span> tail,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//cout&lt;&lt;head&lt;&lt;' '&lt;&lt;tail&lt;&lt;' '&lt;&lt;l&lt;&lt;' '&lt;&lt;r&lt;&lt;endl;</span></div><div class="line">    <span class="keyword">if</span> (head&gt;tail) <span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">if</span> (l==r) </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=head;i&lt;=tail;i++)</div><div class="line">            <span class="keyword">if</span> (q[i].tp==<span class="number">3</span>) ans[q[i].s]=l;<span class="comment">//,cout&lt;&lt;l&lt;&lt;endl;</span></div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head;i&lt;=tail;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">1</span>&amp;&amp;q[i].y&lt;=mid) add(q[i].x,<span class="number">1</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">2</span>&amp;&amp;q[i].y&lt;=mid) add(q[i].x,<span class="number">-1</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">3</span>) tmp[i]=ask(q[i].y)-ask(q[i].x<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head;i&lt;=tail;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">1</span>&amp;&amp;q[i].y&lt;=mid) add(q[i].x,<span class="number">-1</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">2</span>&amp;&amp;q[i].y&lt;=mid) add(q[i].x,<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> l1=<span class="number">0</span>,l2=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head;i&lt;=tail;i++)</div><div class="line">        <span class="keyword">if</span> (q[i].tp==<span class="number">3</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (q[i].cur+tmp[i]&gt;q[i].k<span class="number">-1</span>)<span class="comment">//q[i].cur+tmp[i]表示累积了多少个数</span></div><div class="line">                q1[++l1]=q[i];</div><div class="line">            <span class="keyword">else</span></div><div class="line">            &#123;</div><div class="line">                q[i].cur+=tmp[i];</div><div class="line">                q2[++l2]=q[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (q[i].y&lt;=mid) q1[++l1]=q[i];</div><div class="line">            <span class="keyword">else</span> q2[++l2]=q[i];</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=l1;i++) q[head+i<span class="number">-1</span>]=q1[i];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=l2;i++) q[head+l1+i<span class="number">-1</span>]=q2[i];</div><div class="line">    divide(head,head+l1<span class="number">-1</span>,l,mid);</div><div class="line">    divide(head+l1,tail,mid+<span class="number">1</span>,r);</div><div class="line">&#125;    </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//freopen("ranking.in","r",stdin);</span></div><div class="line">    <span class="comment">//freopen("ranking.out","w",stdout);</span></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) </div><div class="line">    &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">        q[++num].x=i; q[num].y=a[i];</div><div class="line">        q[num].tp=<span class="number">1</span>; q[num].s=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> sign;</div><div class="line">    <span class="keyword">int</span> x,y,z;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"\n%c"</span>,&amp;sign);</div><div class="line">        <span class="keyword">if</span> (sign==<span class="string">'Q'</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</div><div class="line">            q[++num].x=x,q[num].y=y,q[num].k=z;</div><div class="line">            q[num].tp=<span class="number">3</span>; q[num].s=++cnt;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</div><div class="line">            q[++num].x=x; q[num].y=a[x]; </div><div class="line">            q[num].tp=<span class="number">2</span>; q[num].s=<span class="number">0</span>;</div><div class="line">            q[++num].x=x; q[num].y=y;</div><div class="line">            q[num].tp=<span class="number">1</span>; q[num].s=<span class="number">0</span>;</div><div class="line">            a[x]=y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    divide(<span class="number">1</span>,num,<span class="number">0</span>,inf);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//不带修改区间第k小</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200010</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">query</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> x,y,k,id,ty;</div><div class="line">&#125;q[maxn],q1[maxn],q2[maxn];</div><div class="line"><span class="keyword">int</span> ans[maxn];</div><div class="line"><span class="keyword">int</span> V[maxn],len,C[maxn],n;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> x&amp;-x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(x)&#123;</div><div class="line">        ans+=C[x];</div><div class="line">        x-=lowbit(x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    <span class="keyword">while</span>(x&lt;=n)&#123;</div><div class="line">        C[x]+=v;</div><div class="line">        x+=lowbit(x);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> le,<span class="keyword">int</span> ri)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(L&gt;R) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(le==ri)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=L;i&lt;=R;i++)</div><div class="line">            <span class="keyword">if</span>(q[i].ty) ans[q[i].id]=le;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> M=(le+ri)/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L;i&lt;=R;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(!q[i].ty)&#123;</div><div class="line">            <span class="keyword">if</span>(q[i].y&lt;=M)&#123;</div><div class="line">                add(q[i].x,<span class="number">1</span>);</div><div class="line">                q1[a++]=q[i];</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                q2[b++]=q[i];</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">int</span> tem=sum(q[i].y)-sum(q[i].x<span class="number">-1</span>);</div><div class="line">            <span class="keyword">if</span>(tem&gt;=q[i].k)&#123;</div><div class="line">                q1[a++]=q[i];</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                q[i].k-=tem;</div><div class="line">                q2[b++]=q[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L;i&lt;=R;i++)</div><div class="line">        <span class="keyword">if</span>(!q[i].ty&amp;&amp;q[i].y&lt;=M) add(q[i].x,<span class="number">-1</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L;i&lt;L+a;i++) q[i]=q1[i-L];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=L+a;i&lt;=R;i++) q[i]=q2[i-L-a];</div><div class="line">    divide(L,L+a<span class="number">-1</span>,le,M);</div><div class="line">    divide(L+a,R,M+<span class="number">1</span>,ri);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> m;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q[i].y);</div><div class="line">        V[len++]=q[i].y;</div><div class="line">        q[i].x=i+<span class="number">1</span>;q[i].ty=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    sort(V,V+len);</div><div class="line">    len=unique(V,V+len)-V;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</div><div class="line">        q[i].y=lower_bound(V,V+len,q[i].y)-V+<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;q[n+i].x,&amp;q[n+i].y,&amp;q[n+i].k);</div><div class="line">        q[n+i].id=i;q[n+i].ty=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    divide(<span class="number">0</span>,n+m<span class="number">-1</span>,<span class="number">1</span>,len);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,V[ans[i]<span class="number">-1</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="最小表示法"><a href="#最小表示法" class="headerlink" title="最小表示法"></a>最小表示法</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1010</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s);</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">1</span>,k=<span class="number">0</span>,t;</div><div class="line">    <span class="keyword">while</span>(i&lt;n &amp;&amp; j&lt;n &amp;&amp; k&lt;n) &#123;</div><div class="line">        t=s[(i+k)%n]-s[(j+k)%n];</div><div class="line">        <span class="keyword">if</span> (!t) k++;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (t&gt;<span class="number">0</span>) i+=k+<span class="number">1</span>;</div><div class="line">            <span class="keyword">else</span> j+=k+<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span> (i==j) j++;</div><div class="line">            k=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> i&lt;j?i:j;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> s[maxn];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,getmin(s));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="左兄弟右儿子字典树"><a href="#左兄弟右儿子字典树" class="headerlink" title="左兄弟右儿子字典树"></a>左兄弟右儿子字典树</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxnode 4000010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> sigma_size 66</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    <span class="keyword">char</span> c;</div><div class="line">    <span class="keyword">int</span> next,right;</div><div class="line">    <span class="keyword">int</span> sum;</div><div class="line">&#125;;</div><div class="line">ll res=<span class="number">0</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span>&#123;</span></div><div class="line">    node T[maxnode];</div><div class="line">    <span class="keyword">int</span> sz;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">        sz=<span class="number">1</span>;res=<span class="number">0</span>;</div><div class="line">        T[<span class="number">0</span>].next=T[<span class="number">0</span>].right=<span class="number">-1</span>;</div><div class="line">        T[<span class="number">0</span>].sum=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> u=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;!i||s[i<span class="number">-1</span>]!=<span class="string">'\0'</span>;i++)&#123;</div><div class="line">            <span class="keyword">bool</span> flag=<span class="literal">true</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=T[u].next;j!=<span class="number">-1</span>;j=T[j].right)&#123;</div><div class="line">                <span class="keyword">if</span>(T[j].c==s[i])&#123;</div><div class="line">                    res+=(s[i]==<span class="string">'\0'</span>?<span class="number">1</span>:<span class="number">2</span>)*T[j].sum;</div><div class="line">                    T[j].sum++;</div><div class="line">                    flag=<span class="literal">false</span>;</div><div class="line">                    u=j;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(flag)&#123;</div><div class="line">                T[sz].c=s[i];</div><div class="line">                T[sz].right=T[u].next;</div><div class="line">                T[sz].next=<span class="number">-1</span>;</div><div class="line">                T[sz].sum=<span class="number">1</span>;</div><div class="line">                T[u].next=sz;</div><div class="line">                u=sz++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Trie T;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> n,kase=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF&amp;&amp;n)&#123;</div><div class="line">        T.init();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">            <span class="keyword">char</span> s[<span class="number">1010</span>];</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">            T.insert(s);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %lld\n"</span>,++kase,res+n*(n<span class="number">-1</span>)/<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/收集的一些ACM相关的模板/" rel="tag"># 收集的一些ACM相关的模板</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/02/HDU-6058/" rel="next" title="HDU 6058">
                <i class="fa fa-chevron-left"></i> HDU 6058
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/02/hdu-6059/" rel="prev" title="hdu 6059">
                hdu 6059 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="mostshy" />
          <p class="site-author-name" itemprop="name">mostshy</p>
           
              <p class="site-description motion-element" itemprop="description">或许这就是弱渣吧</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">整理的一些常用的ACM模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AC自动机"><span class="nav-number">1.1.</span> <span class="nav-text">AC自动机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CDQ分治"><span class="nav-number">1.2.</span> <span class="nav-text">CDQ分治</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CDQ分治-斜率dp"><span class="nav-number">1.2.1.</span> <span class="nav-text">CDQ分治+斜率dp</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCA"><span class="nav-number">1.3.</span> <span class="nav-text">LCA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RMQ法"><span class="nav-number">1.3.1.</span> <span class="nav-text">RMQ法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LCA倍增法"><span class="nav-number">1.3.2.</span> <span class="nav-text">LCA倍增法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manacher"><span class="nav-number">1.4.</span> <span class="nav-text">Manacher</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SBTree"><span class="nav-number">1.5.</span> <span class="nav-text">SBTree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#splay"><span class="nav-number">1.6.</span> <span class="nav-text">splay</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#splay修改区间为定值"><span class="nav-number">1.6.1.</span> <span class="nav-text">splay修改区间为定值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Treap"><span class="nav-number">1.7.</span> <span class="nav-text">Treap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#划分树——不带修改的区间第k小"><span class="nav-number">1.8.</span> <span class="nav-text">划分树——不带修改的区间第k小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单点修改区间第K大——分块"><span class="nav-number">1.9.</span> <span class="nav-text">单点修改区间第K大——分块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二维树状数组"><span class="nav-number">1.10.</span> <span class="nav-text">二维树状数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二维RMQ"><span class="nav-number">1.11.</span> <span class="nav-text">二维RMQ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后缀数组"><span class="nav-number">1.12.</span> <span class="nav-text">后缀数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#矩阵相交面积——线段树"><span class="nav-number">1.13.</span> <span class="nav-text">矩阵相交面积——线段树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#矩阵周长——线段树"><span class="nav-number">1.14.</span> <span class="nav-text">矩阵周长——线段树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#康拓展开"><span class="nav-number">1.15.</span> <span class="nav-text">康拓展开</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#莫队算法"><span class="nav-number">1.16.</span> <span class="nav-text">莫队算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#树分治"><span class="nav-number">1.17.</span> <span class="nav-text">树分治</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#树链剖分"><span class="nav-number">1.18.</span> <span class="nav-text">树链剖分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#树状数组区间修改"><span class="nav-number">1.19.</span> <span class="nav-text">树状数组区间修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数位dp"><span class="nav-number">1.20.</span> <span class="nav-text">数位dp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拓展KMP"><span class="nav-number">1.21.</span> <span class="nav-text">拓展KMP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整体二分"><span class="nav-number">1.22.</span> <span class="nav-text">整体二分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最小表示法"><span class="nav-number">1.23.</span> <span class="nav-text">最小表示法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#左兄弟右儿子字典树"><span class="nav-number">1.24.</span> <span class="nav-text">左兄弟右儿子字典树</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mostshy</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
